"use strict";function onNotification(e){var t=angular.element(document.body).injector().get("AppService"),n=angular.element(document.body).injector().get("$log");n.log("Received push notification: "+JSON.stringify(e)),"message"==e.type?t.synchronizeChatMessages():"match"==e.type?t.synchronizeMutualMatches():"removeMatch"==e.type?t.removeMatchNotification(e.matchId,e.userId):"reloadProfile"==e.type?t.reloadProfile():"accountBanned"==e.type?t.logout():"test"==e.type&&n.log("Test push notification received")}function onNotificationOpen(e){var t=angular.element(document.body).injector().get("$state"),n=angular.element(document.body).injector().get("$log");n.log("Opened push notification: "+JSON.stringify(e)),"message"===e.type?(n.log("going to menu.chat "+e.message.match.id),t.go("menu.chat",{matchId:e.message.match.id})):"match"===e.type?(n.log("going to menu.match-profile "+e.matchId),t.go("menu.match-profile",{matchId:e.matchId})):"newLikes"===e.type&&(n.log("going to menu.likedMe"),t.go("menu.likedMe"))}function enhance(e,t){for(var n=0;n<t.length;n++)!function(){var o=t[n],r=e;Object.defineProperty(r,o,{get:function(){return this.get(o)},set:function(e){this.set(o,e)}})}()}angular.module("ngCordova.plugins.socialSharing",[]).factory("$cordovaSocialSharing",["$q","$window",function(e,t){return{share:function(n,o,r,i){if(!t.plugins||!t.plugins.socialsharing)return e.reject("socialsharing plugin not found");var a=e.defer();return o=o||null,r=r||null,i=i||null,t.plugins.socialsharing.share(n,o,r,i,function(){a.resolve(!0)},function(){a.reject(!1)}),a.promise},shareViaTwitter:function(n,o,r){var i=e.defer();return o=o||null,r=r||null,t.plugins.socialsharing.shareViaTwitter(n,o,r,function(){i.resolve(!0)},function(){i.reject(!1)}),i.promise},shareViaWhatsApp:function(n,o,r){var i=e.defer();return o=o||null,r=r||null,t.plugins.socialsharing.shareViaWhatsApp(n,o,r,function(){i.resolve(!0)},function(){i.reject(!1)}),i.promise},shareViaFacebook:function(n,o,r){var i=e.defer();return n=n||null,o=o||null,r=r||null,t.plugins.socialsharing.shareViaFacebook(n,o,r,function(){i.resolve(!0)},function(){i.reject(!1)}),i.promise},shareViaFacebookWithPasteMessageHint:function(n,o,r,i){var a=e.defer();return o=o||null,r=r||null,t.plugins.socialsharing.shareViaFacebookWithPasteMessageHint(n,o,r,i,function(){a.resolve(!0)},function(){a.reject(!1)}),a.promise},shareViaSMS:function(n,o){var r=e.defer();return t.plugins.socialsharing.shareViaSMS(n,o,function(){r.resolve(!0)},function(){r.reject(!1)}),r.promise},shareViaEmail:function(n,o,r,i,a,s){var l=e.defer();return r=r||null,i=i||null,a=a||null,s=s||null,t.plugins.socialsharing.shareViaEmail(n,o,r,i,a,s,function(){l.resolve(!0)},function(){l.reject(!1)}),l.promise},shareVia:function(n,o,r,i,a){var s=e.defer();return o=o||null,r=r||null,i=i||null,a=a||null,t.plugins.socialsharing.shareVia(n,o,r,i,a,function(){s.resolve(!0)},function(){s.reject(!1)}),s.promise},canShareViaEmail:function(){var n=e.defer();return t.plugins.socialsharing.canShareViaEmail(function(){n.resolve(!0)},function(){n.reject(!1)}),n.promise},canShareVia:function(n,o,r,i,a){var s=e.defer();return t.plugins.socialsharing.canShareVia(n,o,r,i,a,function(e){s.resolve(e)},function(e){s.reject(e)}),s.promise},available:function(){var t=e.defer();window.plugins.socialsharing.available(function(e){e?t.resolve():t.reject()})}}}]),angular.module("filters",[]).filter("escapeHTML",function(){return function(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;"):""}}).filter("chatDateFormat",function(){var e=6048e5;return function(t){if(!t)return"";var n=Date.now();return n-t.getTime()<e?dateFormat(t,"ddd h:MM TT"):dateFormat(t,"d mmm h:MM TT")}}).filter("dateFormat",function(){return function(e,t){return e?dateFormat(e,t):""}});var platformReady,fbJsSdkLoaded,app=angular.module("ionicApp",["constants","ionic","AppUtil","ImagesUtil","templates","controllers","controllers.share","service.app","ui.slider","ngImgCrop","ngAnimate","pascalprecht.translate","emoji","ImgCache","monospaced.elastic","ngStorage","SocialAuth","ngCookies","filters","chart.js"]).run(["$ionicPlatform","AppService","ImgCache","$rootScope","$log","appName","env","gcpBrowserKey",function(e,t,n,o,r,i,a,s){o.appName=i,e.ready(function(){if(r.log("ionicPlatform.ready"),r.log("env: "+a),window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault(),n.init(function(){r.log("ImgCache init: success!")},function(){r.warn("ImgCache init: error! Check the log for errors")}),"undefined"!=typeof analytics?analytics.startTrackerWithId("UA-94067520-1"):console.log("Google Analytics Unavailable"),window.cordova&&window.cordova.getAppVersion?window.cordova.getAppVersion.getVersionNumber().then(function(e){r.info("App version: "+e),o.appVersion=e}):r.info("cordova.getAppVersion is not available"),"dev"===a){var e=document.createElement("script");e.id="__bs_script__",e.src="http://HOST:3000/browser-sync/browser-sync-client.2.12.12.js".replace("HOST",location.hostname),e.async=!0,document.body.appendChild(e)}var i=document.createElement("script");i.src="https://maps.googleapis.com/maps/api/js?key="+s,i.async=!0,document.body.appendChild(i),t.init(),platformReady=!0})}]).config(["$translateProvider",function(e){e.translations("en",TRANSLATION_EN).translations("de",TRANSLATION_DE).useLocalStorage().fallbackLanguage("en").registerAvailableLanguageKeys(["en","de"],{"en_*":"en","de_*":"de"}).useSanitizeValueStrategy("sanitizeParameters").determinePreferredLanguage()}]).config(["$compileProvider","env",function(e,t){"prod"===t&&(console.log("Disabling $compileProvider debug info"),e.debugInfoEnabled(!1))}]).config(["$ionicConfigProvider",function(e){e.backButton.text("").previousTitleText(!1),ionic.Platform.isWebView()&&!ionic.Platform.isIOS()||e.backButton.text("").icon("ion-ios-arrow-back");var t=!ionic.Platform.isAndroid();e.scrolling.jsScrolling(t)}]).config(["ImgCacheProvider",function(e){e.setOptions({usePersistentCache:!0}),e.manualInit=!0}]).filter("escapeHTML",function(){return function(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;"):""}});angular.module("ionicApp").directive("keyboardScrollSpacer",["$log","$timeout","$ionicScrollDelegate","$document",function(e,t,n,o){return{restrict:"E",scope:{offset:"@",scrollDelegate:"@"},template:'<div style="height:0"></div>',link:function(r,i,a){function s(e){c=e.keyboardHeight,u=e.keyboardHeight-f,i.css("height",u),d.scrollBy(0,u,!1)}function l(e){var n=d.getScrollView().getScrollMax().top-d.getScrollPosition().top;i.css("height",0),t(n<=c?function(){return d.scrollBottom(!1)}:function(){return d.scrollBy(0,-u,!1)})}var c,u,d=n.$getByHandle(r.scrollDelegate),f=0;if(r.offset){var g=o[0].getElementById(r.offset);g?f=g.offsetHeight:e.warn("keyboardScrollSpacer could not find element with id scope.offset")}window.addEventListener("native.keyboardshow",s),window.addEventListener("native.keyboardhide",l),r.$on("$destroy",function(){window.removeEventListener("native.keyboardshow",s),window.removeEventListener("native.keyboardhide",l)})}}}]).directive("return-on-enter",["$timeout",function(e){return{restrict:"A",scope:{returnClose:"=",onReturn:"&",onFocus:"&",onBlur:"&"},link:function(t,n,o){n.bind("focus",function(n){t.onFocus&&e(function(){t.onFocus()})}),n.bind("blur",function(n){t.onBlur&&e(function(){t.onBlur()})}),n.bind("keydown",function(o){13==o.which&&(t.returnClose&&n[0].blur(),t.onReturn&&e(function(){t.onReturn()}))})}}}]);var TRANSLATION_EN={OK:"Ok",SAVE:"Save",SEND:"Send",CANCEL:"Cancel",DELETE:"Delete",EDIT:"Edit",LOADING:"Loading",REMOVE:"Remove",REPORT:"Report",LOG_IN:"Log in",LOGOUT:"Logout",EMAIL:"Email",REGISTER:"Register",ADMIN:"Admin",SENDING:"Sending",RESEND:"Resend",ACCEPT:"Accept",REJECT:"Reject",CALLING:"Calling",VERSION:"Version",INVALID_EMAIL_PASSWORD:"Invalid email/password",ACCOUNT_BANNED:"This account has been disabled",PULL_TO_REFRESH:"Pull to refresh...",LANGUAGE:"Language",PASSWORD:"Password",RESET_PASSWORD:"Reset password",PASSWORD_RESET_SENT:"Password reset link emailed",PASSWORD_LENGTH:"Password must be at least 6 characters",INVALID_EMAIL:"Enter a valid email",LOGGING_IN_TO_FB:"Logging into Facebook",LOGGING_IN_TO_LINKEDIN:"Logging into LinkedIn",LOADING_PROFILE:"Loading profile",LOADING_FB_PROFILE:"Loading Facebook profile",CREATING_ACCOUNT:"Creating account",WAITING_FOR_GPS:"Waiting for GPS location",LOGIN_ERROR:"Error logging in. Try again later",VERIFY_EMAIL_MESSAGE:"Check your inbox for an email to verify your address, then come back and click the button below",CHECK_EMAIL_VERIFICATION:"Check Email Verification",EMAIL_NOT_VERIFIED:"Email is not verified",FIRST_NAME_REQUIRED:"First name is required",SURNAME_REQUIRED:"Surname is required",BIRTH_DAY_REQUIRED:"Birth day is required",BIRTH_MONTH_REQUIRED:"Birth month is required",BIRTH_YEAR_REQUIRED:"Birth year is required",GENDER_REQUIRED:"Gender is required",TERMS_OF_USE:"Terms of Use",MENU_PROFILE:"My Profile",MENU_MATCHES:"Find Matches",MENU_CHAT:"Chat",MENU_LIKED_ME:"People Who Liked Me",MENU_DISCOVERY:"Discovery Preferences",MENU_SETTINGS:"Settings",MENU_CONTACT:"Send Your Feedback",MENU_SHARE:"Invite My Friends",MENU_CO_PARENTS:"My Co-Parents Shortlist",ABOUT_JUST_A_BABY:"About Just a Baby",FAQ:"FAQ",SHARE_VIDEO:"Share A Video",PROFILE_SETUP_MSG:"We need a couple more details",BIRTH_DAY:"Birth day",BIRTH_MONTH:"Birth month",BIRTH_YEAR:"Birth year",FIRST_NAME:"First name",GENDER:"Gender",MALE:"Male",FEMALE:"Female",PROFILE_TITLE:"My Profile",ABOUT:"About",FRIENDS_USING:"My Friends",MY_INTERESTS:"My Interests",EDIT_PROFILE_TITLE:"Edit Profile",ABOUT_YOU:"Tell us your story, your vision. Be open and let people know what you're looking for.",AWAY:"away",SELECT_PHOTO_SOURCE:"Select photo source",TAKE_PHOTO:"Take photo",GALLERY:"Gallery",PHOTO_ERROR:"An error occurred getting the photo",ALBUMS:"Albums",NO_FB_ALBUMS:"You don't have any Facebook albums",ADD_A_PHOTO:"Add a photo",CROP_YOUR_PHOTO:"Crop your photo",DISCOVERY_TITLE:"Discovery Preferences",DISCOVERABLE:"Discoverable",SHOW_ME:"Show me",GUYS:"Guys",GIRLS:"Girls",SEARCH_DISTANCE:"Search distance",AGED_BETWEEN:"Aged between",SETTINGS_TITLE:"App Settings",NOTIFICATION_SOUND:"Notification Sound",NEW_MATCH:"New match",NEW_MESSAGE:"New message",SHOW_DISTANCES_IN:"Show distances in",NOT_DISCOVERABLE:"You're not discoverable",ENABLE_DISCOVERY_TO_MEET:"Enable discovery to meet new people nearby",ENABLE_DISCOVERY:"Enable Discovery",FINDING_PEOPLE:"Finding people near you",NO_ONE_NEW:"There's no one new around you",SEARCH_AGAIN:"Search",LIKE:"Like",NOT_LIKE:"Nope",LOCATION:"Location",SET_LOCATION:"Set Location",USE_GPS_LOCATION:"Use GPS location",GPS_ERROR:"Unable to get GPS location",SET_MAP_LOCATION:"Please set your location on the map and press save",NO_MATCHES:"You don't have any matches yet.",START_SWIPING:"Start swiping",MATCHES_LOAD_ERROR:"Unable to load matches",ITS_A_MATCH:"It's A Match",LIKED_EACH_OTHER:"You and {{name}} have liked each other",SEND_MESSAGE:"Send Message",KEEP_SEARCHING:"Keep Searching",MATCHED_ON:"You matched on",REMOVE_MATCH:"Remove match",MATCH_OPTIONS:"Match options",REMOVE_MATCH_ERROR:"Error removing match. Try again later",UNMATCHED:"You were unmatched",MATCH_REPORTED:"Match reported",WANT_TO_REMOVE_MATCH:"Do you want to remove this match?",INAPPROPRIATE_CONTENT:"Report user for inappropriate content",COPY_TEXT:"Copy text",SAVE_IMAGE:"Save image",DELETE_MESSAGE:"Delete message",FAILED_TO_SEND:"Failed to send",TYPE_YOUR_MESSAGE:"Type your message",MESSAGE_NOT_SENT:"Message not sent. Try again",INCOMING_CALL_FROM:"Incoming call from",HANG_UP:"Hang Up",WAITING_FOR_REPLY:"Waiting for reply",VIDEO_SERVICE_ERROR:"An error occurred with the video service",VIDEO_START_ERROR:"Unable to start the video call",NO_LIKES:"Check back soon, no likes yet",SETTINGS_SAVE_ERROR:"Error saving settings. Try again later",REQUEST_FAILED:"Request failed",GIVE_US_FEEDBACK:"Just a Baby is built for you. We want your suggestions and your feedback so that we can make it better! Tell us what you like, what you hate, and how we could improve the experience. If you include your email address we'll endeavour to reply. Thanks in advance.",DELETE_ACCOUNT:"Delete your account","":""},TRANSLATION_DE={OK:"Ok",SAVE:"Sparen",SEND:"Senden",CANCEL:"Absagen",LOGOUT:"Abmelden",LANGUAGE:"Sprache",REGISTER:"Sich einschreiben",LOGGING_IN_TO_FB:"Anmelden bei Facebook",LOADING_PROFILE:"Laden profil",SETTINGS_TITLE:"Einstellungen",NOTIFICATION_SOUND:"Benachrichtigung klingen",NEW_MATCH:"Neues spiel",NEW_MESSAGE:"Neues nachricht",SHOW_DISTANCES_IN:"Zeigt Entfernungen in",DELETE_ACCOUNT:"Mitgliedskonto lÃ¶schen"};angular.module("ionicApp").config(["$stateProvider",function(e){e.state("menu.adminMenu",{url:"/admin",views:{menuContent:{templateUrl:"admin/adminMenu.html"}}}).state("menu.reportedUsers",{url:"/reportedUsers",views:{menuContent:{templateUrl:"admin/reportedUsers.html",controller:"ReportedUsers"}}}).state("menu.bannedUsers",{url:"/bannedUsers",views:{menuContent:{templateUrl:"admin/bannedUsers.html",controller:"BannedUsers"}}}).state("menu.applyBadges",{url:"/applyBadges",views:{menuContent:{templateUrl:"admin/applyBadges.html",controller:"ApplyBadges"}}}).state("menu.adminEmailSearch",{url:"/adminEmailSearch",views:{menuContent:{templateUrl:"admin/adminEmailSearch.html"}}}).state("menu.adminNameSearch",{url:"/adminNameSearch",views:{menuContent:{templateUrl:"admin/adminNameSearch.html"}}}).state("menu.userAdmin",{url:"/userAdmin/:userId",views:{menuContent:{templateUrl:"admin/userAdmin.html"}}}).state("menu.adminPhotoReview",{url:"/adminPhotoReview/",views:{menuContent:{templateUrl:"admin/photo-review.html"}}}).state("menu.adminClinics",{url:"/adminClinics/",views:{menuContent:{templateUrl:"admin/clinics-question.html"}}}).state("menu.adminAbout",{url:"/adminAbout/",views:{menuContent:{templateUrl:"admin/about-jab.html"}}}).state("menu.adminWhereUHeardUs",{url:"/adminWhereUHeardUs/",views:{menuContent:{templateUrl:"admin/where-u-heard.html"}}}).state("menu.adminVoteReport",{url:"/adminVoteReport/",views:{menuContent:{templateUrl:"admin/vote-report.html"}}}).state("menu.adminGraph",{url:"/adminGraph/",views:{menuContent:{templateUrl:"admin/graph.html"}}})}]);var dateFormat=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,o=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e};return function(r,i,a){var s=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(r)||/\d/.test(r)||(i=r,r=void 0),r=r?new Date(r):new Date,isNaN(r))throw SyntaxError("invalid date");i=String(s.masks[i]||i||s.masks["default"]),"UTC:"==i.slice(0,4)&&(i=i.slice(4),a=!0);var l=a?"getUTC":"get",c=r[l+"Date"](),u=r[l+"Day"](),d=r[l+"Month"](),f=r[l+"FullYear"](),g=r[l+"Hours"](),p=r[l+"Minutes"](),h=r[l+"Seconds"](),m=r[l+"Milliseconds"](),v=a?0:r.getTimezoneOffset(),S={d:c,dd:o(c),ddd:s.i18n.dayNames[u],dddd:s.i18n.dayNames[u+7],m:d+1,mm:o(d+1),mmm:s.i18n.monthNames[d],mmmm:s.i18n.monthNames[d+12],yy:String(f).slice(2),yyyy:f,h:g%12||12,hh:o(g%12||12),H:g,HH:o(g),M:p,MM:o(p),s:h,ss:o(h),l:o(m,3),L:o(m>99?Math.round(m/10):m),t:g<12?"a":"p",tt:g<12?"am":"pm",T:g<12?"A":"P",TT:g<12?"AM":"PM",Z:a?"UTC":(String(r).match(t)||[""]).pop().replace(n,""),o:(v>0?"-":"+")+o(100*Math.floor(Math.abs(v)/60)+Math.abs(v)%60,4),S:["th","st","nd","rd"][c%10>3?0:(c%100-c%10!=10)*c%10]};return i.replace(e,function(e){return e in S?S[e]:e.slice(1,e.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(e,t){return dateFormat(this,e,t)};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){angular.module("service.app",["ngCordova","service.parse","service.localdb"]).factory("AppService",["$rootScope","$timeout","$http","$cordovaFacebook","$cordovaGeolocation","$cordovaMedia","$log","$state","$q","$ionicHistory","ParseService","LocalDB","$localStorage","$interval","$translate","adMob","$cordovaBadge",function(e,t,n,o,r,i,a,s,l,c,u,d,f,g,p,h,m){function v(){return l.all(d.init(),et.init())}function S(e){return et.facebookLogin(e).then(function(e){return St.userId=e.id,A(e)})}function y(e){return et.linkedInLogin(e).then(function(e){return St.userId=e.id,A(e)})}function E(e,t){return et.signUp(e,t).then(function(e){return St.userId=e.id,A(e)})}function P(e,t){return et.logIn(e,t).then(function(e){return St.userId=e.id,A(e)})}function b(){var e=et.autoLogin();w(),A(e)}function A(t){return St.user=t,d.userId=t.id,"undefined"!=typeof analytics&&(analytics.setUserId(t.id),analytics.trackView("UserLogin Controller")),d.getProfiles().then(function(e){var t=!0,n=!1,o=void 0;try{for(var r,i=e[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var a=r.value;rt[a.id]=a}}catch(s){n=!0,o=s}finally{try{!t&&i["return"]&&i["return"]()}finally{if(n)throw o}}return d.getMatches()}).then(function(e){var t=!0,n=!1,o=void 0;try{for(var r,i=e[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var s=r.value;s.otherProfile=rt[s.get("otherProfileId")],pe(s.id)?a.error("Found duplicate when loading matches from LocalDB"):tt.push(s)}}catch(l){n=!0,o=l}finally{try{!t&&i["return"]&&i["return"]()}finally{if(n)throw o}}return T()}).then(null,function(e){return a.error("Error loading local db data "+JSON.stringify(e))}),t.admin&&(e.isAdmin=!0),a.log("logged in with "+JSON.stringify(t)),et.getTwilioToken().then(function(t){t?(a.info("Aquired twilio token"),St.twilioAccessToken=t.token,e.$broadcast("twilioAccessToken",t.token)):a.info("Twilio is not configured. getTwilioToken returned null")},function(e){"NOT_CONFIGURED"===e?a.info("Twilio not configured"):a.error("Error getting twilio token "+JSON.stringify(e))}),M(),C(),t}function T(){d.getUnreadChats().then(function(t){return console.log("LocalDB.getUnreadChats() "+JSON.stringify(t)),nt=t,ot=_.keys(nt).length,a.log("unread count "+ot),e.$broadcast("unreadChatsCountUpdated"),"undefined"!=typeof cordova&&m.set(ot).then(null,function(e){return a.info(e)}),ot})}function C(){if("undefined"==typeof AdMob)return void a.info("AdMob plugin is not installed");a.info("Checking AdMob configuration...");var e=null;/(android)/i.test(navigator.userAgent)?h.android&&h.android.banner&&h.android.interstitial&&(e=h.android,a.info("Using Android AdMob ids")):/(ipod|iphone|ipad)/i.test(navigator.userAgent)&&h.ios&&h.ios.banner&&h.ios.interstitial&&(e=h.ios,a.info("Using iOS AdMob ids")),e&&AdMob&&(a.info("Creating AdMob banner"),AdMob.createBanner({adId:e.banner,position:AdMob.AD_POSITION.BOTTOM_CENTER,autoShow:!0}))}function M(){if("undefined"==typeof store)return void a.info("In-app purchase plugin is not installed")}function w(){return et.reloadUser()}function R(){if(St.profile)return a.log("reloading profile"),et.reloadProfile(St.profile).then(function(e){return O(e),a.log("reloaded profile to "+JSON.stringify(e)),et.profile=e,et.profile})}function O(e){e.birthdate&&!e.age&&(e.age=new Date(new Date-new Date(e.birthdate)).getFullYear()-1970)}function I(){return et.reloadUser().then(function(e){return e.emailVerified===!0})}function U(){return f.termsOfUseAgreed=!0,l.when()}function N(e){return et.requestPasswordReset(e)}function L(){return St.profile?l.when(St.profile):et.getProfile().then(function(e){return e?(O(e),a.log("AppService server.getProfile returned "+JSON.stringify(e)),St.profile=e,St.profile):null})}function F(e){return et.getProfileOfSelectedUser(e)}function D(){return St.profile}function k(e){a.debug("getProfileByMatchId "+e);var t=_.find(tt,"id",e);if(t){var n=t.get("otherProfileId");n||(n=t.profileId);var o=rt[n];if(o)return(!o.refreshedAt||o.refreshedAt<Date.now()-36e5)&&et.getProfileForMatch(e).then(function(e){a.debug("refreshed profile "+e.id+" from the server"),e.refreshedAt=Date.now(),rt[e.id]=e,_.assign(o,e)}),l.when(o)}return a.log("getProfileByMatchId going to the server"),et.getProfileForMatch(e).then(function(e){return rt[e.id]=e,e})}function $(e){return rt[e]}function B(e){return _.find(rt,"uid",e)}function G(){var t=St.user;return"banned"==t.status?void V("banned"):e.facebookConnected||t.emailVerified!==!1?x()?D().location?vt?(vt=!1,void V("walkthru")):f.termsOfUseAgreed?St.profile.about?(H(),void V("menu.home")):void s.go("menu.profile-edit"):void V("termsOfUse"):void V("locationSetup"):void V("profileSetup"):void V("emailVerification")}function V(e){c.nextViewOptions({historyRoot:!0,disableBack:!0}),s.go(e)}function H(){var e=function(){++ut===ct?(ut=0,de()):fe()};a.debug("Performing initial data sync"),de()["finally"](fe),dt||(a.log("Starting data synchronization timer"),dt=g(e,lt))}function x(){return St.profile.birthdate&&St.profile.name&&St.profile.gender}function J(){if(a.log("requestLocationServices()"),!ionic.Platform.isWebView())return l.resolve();var e=l.defer();return a.log("locationAccuracy.request()"),cordova.plugins.locationAccuracy.request(function(){a.log("locationAccuracy.request() = success"),e.resolve()},function(t){a.log("locationAccuracy.request() = error: "+JSON.stringify(t)),t&&t.code!==cordova.plugins.locationAccuracy.ERROR_USER_DISAGREED&&window.confirm("Failed to automatically set Location Mode to 'High Accuracy'. Would you like to switch to the Location Settings page and do this manually?")&&(a.log("diagnostic.switchToLocationSettings()"),cordova.plugins.diagnostic.switchToLocationSettings(),a.log("diagnostic.switchToLocationSettings() returned")),e.resolve()},cordova.plugins.locationAccuracy.REQUEST_PRIORITY_HIGH_ACCURACY),e.promise}function W(){a.log("getCurrentPosition()");var e=1e4,n=l.defer();if(ionic.Platform.isAndroid()&&"undefined"!=typeof cordova&&cordova.plugins.locationServices)return a.log("locationServices.geolocation.getCurrentPosition()"),cordova.plugins.locationServices.geolocation.getCurrentPosition(function(e){if(a.log("locationServices.geolocation.getCurrentPosition() = "+JSON.stringify(e)),e&&e.coords){a.log("latitude:"+e.coords.latitude+", longitude: "+e.coords.longitude);var t=et.convertLocation(e.coords.latitude,e.coords.longitude);n.resolve(t)}else n.reject("GEO_ERROR")},function(e){n.reject("GEO_ERROR"),console.warn("locationServices error "+JSON.stringify(e))},{timeout:e,priority:100}),n.promise;a.log("$cordovaGeolocation.getCurrentPosition()");var o=function(){a.log("$cordovaGeolocation.getCurrentPosition did not return within the timeout"),n.reject("GEO_ERROR")},i=t(o,e+1e3);return r.getCurrentPosition().then(function(e){t.cancel(i),a.log("location "+JSON.stringify(e));var o=et.convertLocation(e.coords.latitude,e.coords.longitude);n.resolve(o)},function(e){t.cancel(i),a.log("getCurrentPosition error: "+JSON.stringify(e)),n.reject("GEO_ERROR")},{maximumAge:36e5,timeout:e,enableHighAccuracy:!0}),n.promise}function j(e){var t={notifyMatch:e.notifyMatch,notifyMessage:e.notifyMessage,distanceType:e.distanceType,distance:e.distance};return et.saveSettings(St.profile,t).then(function(e){return a.log("saveSettings result:"+JSON.stringify(e)),St.profile})}function q(){return et.copyFacebookProfile().then(function(e){return vt=!0,St.profile=e,St.profile})}function Q(){return Y({enabled:!0})}function Y(e){return a.log("saving profile"),et.saveProfile(St.profile,e).then(function(e){return St.profile})}function K(e,t){return a.log("applying badge"),et.saveProfileForApplyBadge(e,t)}function z(){St.userId=null,St.fbId=null,St.profile=null,tt=[],rt={},it=null,at=null,nt={},ot=0,dt&&(g.cancel(dt),dt=null),et.logout(),localStorage.clear(),f.$reset(),mt&&d.deleteDb(),e.facebookConnected&&(a.log("logging out of Facebook"),o.logout().then(function(t){a.log("logged out of facebook"),delete e.facebookConnected,delete e.fbAccessToken},function(e){a.log("error logging out of Facebook "+JSON.stringify(e))})),c.clearCache(),c.nextViewOptions({disableBack:!0}),s.go("signin")}function Z(){return mt=!0,et.deleteAccount().then(function(){z()})}function X(){return et.deleteUnmatched()}function ee(e,t){return et.processProfile(e,t,!1).then(function(e){a.log("processed match action"),"undefined"!=typeof analytics&&analytics.trackView("Swipe Controller"),e&&"M"===e.state&&("undefined"!=typeof analytics&&analytics.trackView("Match Controller"),de())},function(e){a.error("error processing match "+JSON.stringify(e))})}function te(e,t,n){return et.processProfile(e,t,n).then(function(e){a.log("processed match action from admin"),e&&"M"===e.state&&de()},function(e){a.error("error processing match from admin"+JSON.stringify(e))})}function ne(e,t){return et.processPregnancy(e,t).then(function(e){a.log("processed impregnate action"+e)},function(e){a.error("error processing pregnancy invitation "+JSON.stringify(e))})}function oe(e){return a.log("removeMatch "+e),et.removeMatch(e).then(function(t){d.deleteMatch(e),_.remove(tt,{id:e})})}function re(t,n){if(a.log("removeMatchNotification matchId:"+t+" userId:"+n),tt){if(n&&!t){var o=_.find(tt,function(e){return e.uid1===n||e.uid2===n});if(!o)return void a.error("Could not find match with userId "+n+" to remove from notification");t=o.id}_.remove(tt,{id:t}),it==t&&(it=null,at=null,a.log("cleared active chat from remove notification")),d.deleteMatch(t),e.$broadcast("chatsUpdated",t)}}function ie(){return St.profileSearchResults}function ae(){return et.searchProfiles(St.profile).then(function(t){return St.profileSearchResults=t,e.$broadcast("newProfileSearchResults"),St.profileSearchResults})}function se(){return et.getProfilesWhoLikeMe()}function le(){return et.getProfilesWhoWantsToHaveARelationshipWithMe()}function ce(){St.profileSearchResults=null}function ue(){return a.log("getMutualMatches()"),tt}function de(){if(ft)return a.debug("Match sync already in progress. requesting..."),gt=!0,l.when();ft=!0;var n,o=!1;return a.debug("synchronizeMutualMatches()"),et.reloadUser().then(function(e){var t=_.pluck(tt,"id"),r=e.matches,i=_.difference(t,r);n=_.difference(r,t),o=n.length||i.length,a.debug("Found "+i.length+" mutual matches to remove"),a.debug("Found "+n.length+" mutual matches to add");var s=!0,l=!1,c=void 0;try{for(var u,d=i[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var f=u.value;re(f)}}catch(g){l=!0,c=g}finally{try{!s&&d["return"]&&d["return"]()}finally{if(l)throw c}}return et.getMatches(n)}).then(function(t){a.debug("loaded "+t.length+" matches to sync"),n.length!==t.length&&(a.info("Rebuilding matches"),et.rebuildMatches());var r=!0,i=!1,s=void 0;try{for(var l,c=t[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var u=l.value;if(pe(u.id))a.info("Match "+u.id+" already stored");else{console.log("storing new match "+u.id);var f=u.profile;u.lastMessage="Matched on "+dateFormat(u.createdAt,"d mmm"),u.read=!1,tt.unshift(u),d.saveMatch(u,f),rt[f.id]=f}}}catch(g){i=!0,s=g}finally{try{!r&&c["return"]&&c["return"]()}finally{if(i)throw s}}return t.length&&(a.debug("broadcasting newMatch id:"+t[0].id),e.$broadcast("newMatch",t[0]),St.profile.notifyMatch&&Xe("audio/match-notification.mp3")),o&&(e.$broadcast("chatsUpdated"),T()),t}).then(function(e){return e},function(e){return a.error("Error synching matches "+JSON.stringify(e)),l.reject(e)})["finally"](function(){a.log("Match sync complete"),ft=!1,gt&&(a.log("Additional match sync requested"),gt=!1,t(de))})}function fe(){if(0===tt.length)return l.when();if(pt)return a.debug("Chat sync already in progress. requesting..."),ht=!0,l.when();pt=!0;var n=_.indexBy(tt,"id"),o=f.lastChatSyncTime;a.info("typeof "+("undefined"==typeof o?"undefined":_typeof(o)));var r=!1;return a.info("synchronizing chat messages"+(o?" from "+o:"")),"string"==typeof o&&(o=new Date(o)),et.loadChatMessages(o).then(function(t){a.info("Found "+t.length+" chat messages to synchronize");var o=[],i=!0,s=!1,c=void 0;try{for(var u,d=t[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){var g=u.value;o.push(ge(n[g.match.id],g))}}catch(p){s=!0,c=p}finally{try{!i&&d["return"]&&d["return"]()}finally{if(s)throw c}}l.all(o).then(function(e){t.length&&(f.lastChatSyncTime=_.max(_.pluck(t,"createdAt"))),T();var n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;r|=l}}catch(c){o=!0,i=c}finally{try{!n&&s["return"]&&s["return"]()}finally{if(o)throw i}}r&&St.profile.notifyMessage&&Xe("audio/chat-notification.mp3")},function(e){return a.error("Error saving chat messages "+JSON.stringify(e))});var h=null,m=_.indexBy(at,"id"),v=!0,S=!1,y=void 0;try{for(var E,P=t[Symbol.iterator]();!(v=(E=P.next()).done);v=!0){var b=E.value;b.match.id!=it||m[b.id]||(at.push(b),at.sort(function(e,t){return e.createdAt.getTime()-t.createdAt.getTime()}),h=b)}}catch(p){S=!0,y=p}finally{try{!v&&P["return"]&&P["return"]()}finally{if(S)throw y}}null!==h&&(a.log("broadcasting newMessage"),e.$broadcast("newMessage",h))})["finally"](function(){a.log("Chat sync complete"),pt=!1,ht&&(a.log("Additional chat sync requested"),ht=!1,t(de))})}function ge(t,n){return d.saveChatMessage(n).then(function(o){return o&&t&&(t.lastMessage=n.lastMessage,n.createdAt.getTime()>t.updatedAt.getTime()&&(t.lastMessageAt=n.createdAt),n.sender!==et.getUserId()&&me(t.id,!1),e.$broadcast("chatsUpdated"),tt.sort(function(e,t){return e.updatedAt.getTime()===t.updatedAt.getTime()?0:e.updatedAt.getTime()>t.updatedAt.getTime()?-1:1})),o})}function pe(e){return _.find(tt,"id",e)}function he(e){return a.log("getActiveChat "+e),e===it?l.when(at):d.getChatMessages(e).then(function(t){return it=e,at=t})}function me(e,t){if(!_.isBoolean(t))throw"read must be a boolean";var n=_.find(tt,{id:e});null!=n&&n.read!=t&&(n.read=t,d.setChatRead(e,t).then(function(){return T()}))}function ve(){return ot}function Se(){return et.resetBadge()}function ye(e,t,n,o){"undefined"!=typeof analytics&&analytics.trackView("SendMessage Controller");var r=_.find(tt,{id:e});r.id=e;var i=new ChatMessage;return i.match=r,t&&(i.text=t),i.senderName=St.profile.name,et.sendChatMessage(i,n,o).then(function(t){return a.log("sent chat message for match "+e),it===e&&(a.log("adding to active chat messages"),at.push(t),at.sort(function(e,t){return e.createdAt.getTime()-t.createdAt.getTime()})),ge(r,t),t})}function Ee(e,t,n){return a.log("reporting profile "+JSON.stringify(t)),et.reportProfile(e,t,n)}function Pe(e){return et.sendContactMessage(e)}function be(e){return et.saveFile("photo.png",e).then(function(e){a.log("photo saved. saving to profile...");var t={};return st?(t.photosInReview=St.profile.photosInReview,t.photosInReview||(t.photosInReview=[]),t.photosInReview.push(e)):(t.photos=St.profile.photos,t.photos||(t.photos=[]),t.photos.push(e)),et.saveProfile(St.profile,t)}).then(function(e){return a.log("saved profile with photo"),e},function(e){return a.log("error saving photo file to profile "+JSON.stringify(e)),l.reject(e)})}function Ae(e){return St.profile.birthdate=e,St.profile.ageFrom=18,St.profile.ageFrom<18&&(St.profile.ageFrom=18),St.profile.ageTo=55,et.saveProfile(St.profile,St.profile)}function Te(){return et.testPushNotification();
}function Ce(){return et.getReportedUsers()}function Me(){return et.getBannedUsers()}function we(){return et.getApplyBadgeUsers()}function Re(e){return et.getReportedUserDetails(e)}function _e(e,t){return et.deletePhoto(e,t)}function Oe(e){return et.banUser(e)}function Ie(e,t){return et.closeReport(e,t)}function Ue(e){return et.searchUsersByEmail(e)}function Ne(e){return et.searchUsersByName(e)}function Le(e){return et.loadUser(e)}function Fe(e){return et.deleteUser(e)}function De(){return et.getProfilesWithPhotosToReview()}function ke(e,t,n){if(a.log("reviewPhoto",e,t,n),!e)throw"profileId is required";if(!t)throw"fileUrl is required";return et.reviewPhoto(e,t,n)}function $e(e){return et.addClinicsQuestion(e)}function Be(){return"undefined"!=typeof analytics&&analytics.trackView("Become A Parent Controller"),et.getClinicsQuestion()}function Ge(e){return et.delClinicsQuestion(e)}function Ve(e){return et.addFindUs(e)}function He(){return et.getFindUs()}function xe(e){return et.delFindUs(e)}function Je(e){return et.addFindUsReport(e)}function We(){return et.getFindUsReport()}function je(e){return et.getFindUsReport(e)}function qe(e){return et.addAboutJab(e)}function Qe(){return et.getAboutJab()}function Ye(e){return et.getMatchesReport(e)}function Ke(e){return et.getChatMessageReport(e)}function ze(){return et.getProfileNew(St.profile)}function Ze(e){return ionic.Platform.isIOS()?e:ionic.Platform.isAndroid()?"/android_asset/www/"+e:e}function Xe(e){if(ionic.Platform.isWebView()){var t=new Media(Ze(e));t.play({playAudioWhenScreenIsLocked:!1})}}var et=u,tt=[],nt={},ot=0,rt={},it=null,at=null,st=!1,lt=5e3,ct=2,ut=0,dt=null,ft=!1,gt=!1,pt=!1,ht=!1,mt=!1,vt=!1,St={isLoggedIn:!1,user:null,userId:"",fbId:"",profile:null,profileSearchResults:null,twilioAccessToken:null,init:v,facebookLogin:S,linkedInLogin:y,signUp:E,logIn:P,autoLogin:b,reloadUser:w,reloadProfile:R,isEmailVerified:I,termsOfUseAgreed:U,requestPasswordReset:N,goToNextLoginState:G,loadProfile:L,getProfile:D,getProfileOfSelectedUser:F,getProfileById:$,getProfileByUserId:B,getProfileByMatchId:k,saveBirthdate:Ae,saveProfile:Y,saveProfileForApplyBadge:K,saveSettings:j,enableDiscovery:Q,requestLocationServices:J,getCurrentPosition:W,copyFacebookProfile:q,setPhoto:be,getProfileSearchResults:ie,updateProfileSearchResults:ae,getProfilesWhoLikeMe:se,getProfilesWhoWantsToHaveARelationshipWithMe:le,clearProfileSearchResults:ce,removeMatchNotification:re,deleteUnmatched:X,processMatch:ee,processMatchFromAdmin:te,processPregnancy:ne,getMutualMatches:ue,getMatch:pe,getActiveChat:he,setChatRead:me,getUnreadChatsCount:ve,sendChatMessage:ye,removeMatch:oe,reportProfile:Ee,synchronizeMutualMatches:de,synchronizeChatMessages:fe,resetBadge:Se,sendContactMessage:Pe,logout:z,deleteAccount:Z,testPushNotification:Te,getReportedUsers:Ce,getBannedUsers:Me,getApplyBadgeUsers:we,getReportedUserDetails:Re,deletePhoto:_e,banUser:Oe,closeReport:Ie,getProfilesWithPhotosToReview:De,reviewPhoto:ke,searchUsersByEmail:Ue,searchUsersByName:Ne,loadUser:Le,deleteUser:Fe,addClinicsQuestion:$e,getClinicsQuestion:Be,delClinicsQuestion:Ge,getFindUs:He,addFindUs:Ve,delFindUs:xe,addFindUsReport:Je,getFindUsReport:We,delFindUsReport:je,addAboutJab:qe,getAboutJab:Qe,getMatchesReport:Ye,getChatMessageReport:Ke,getProfileNew:ze};return St}])}();var userFields=["emailVerified","admin","matches","profile","status","premium","credits"],profileFields=["uid","name","birthdate","age","about","photos","photosInReview","notifyMatch","notifyMessage","distance","distanceType","location","gps","enabled","gender","guys","girls","ageFrom","ageTo","personCategory","personType","personSperm","personEgg","personWomb","personEmbryo","personHelpLevel","hasSelfId","LFSperm","LFEggs","LFWomb","LFEmbryo","LFNot","LFHelpM","LFHelpO","thingsIHave","LFSelfId"],Profile=Parse.Object.extend({className:"Profile",attrs:profileFields}),matchFields=["uid1","uid2","uid1action","uid2action","state","profile1","profile2","lastMessage","read","matchedDate"],Match=Parse.Object.extend({className:"Match",attrs:matchFields}),chatMessageFields=["match","userIds","text","image","audio","sender","senderName"],ChatMessage=Parse.Object.extend({className:"ChatMessage",attrs:chatMessageFields}),reportFields=["matchId","reportedBy","reportedUser","match","profile","photo","reason","actionTaken","actionUser"],Report=Parse.Object.extend({className:"Report",attrs:reportFields}),contactMessageFields=["user","message"],ContactMessage=Parse.Object.extend({className:"ContactMessage",attrs:contactMessageFields}),clinicsQuestionFields=["answer","question","position","type","video"],ClinicsQuestion=Parse.Object.extend({className:"ClinicsQuestion",attrs:clinicsQuestionFields}),findUsFields=["name"],FindUs=Parse.Object.extend({className:"FindUs",attrs:findUsFields}),aboutJabFields=["message","videoId"],AboutJab=Parse.Object.extend({className:"AboutJab",attrs:aboutJabFields}),findUsReportFields=["username","name","checked"],FindUsReport=Parse.Object.extend({className:"FindUsReport",attrs:findUsReportFields});enhance(Parse.User.prototype,userFields),enhance(Profile.prototype,profileFields),enhance(Match.prototype,matchFields),enhance(ChatMessage.prototype,chatMessageFields),enhance(Report.prototype,reportFields),enhance(ContactMessage.prototype,contactMessageFields),enhance(ClinicsQuestion.prototype,clinicsQuestionFields),enhance(FindUs.prototype,findUsFields),enhance(FindUsReport.prototype,findUsReportFields),enhance(AboutJab.prototype,aboutJabFields),Object.defineProperty(ChatMessage.prototype,"lastMessage",{get:function(){return this.text?this.text:this.image?":rice_scene:":this.audio?":speaker:":""}}),Object.defineProperty(Profile.prototype,"photoUrl",{get:function(){if(this.photos&&this.photos.length){var e=this.photos[0];if(e._url)return e._url;if(angular.isFunction(e.url))return e.url();if(angular.isString(e.url))return e.url}return"img/generic_avatar.jpg"}}),Object.defineProperty(Match.prototype,"profileId",{get:function(){return null!=this.otherProfileId?this.otherProfileId:this.otherProfile?this.otherProfile.id:this.uid1==Parse.User.current().id?this.profile2.id:this.uid2==Parse.User.current().id?this.profile1.id:null}}),Object.defineProperty(Match.prototype,"profile",{get:function(){return this.otherProfile?this.otherProfile:this.otherProfileId?this.otherProfileId==this.profile1.id?this.profile1:this.profile2:this.uid1==Parse.User.current().id?this.profile2:this.uid2==Parse.User.current().id?this.profile1:null},set:function(e){this.otherProfile=e}}),Parse.Promise.prototype["finally"]=function(e){return this.always(e)},Parse.Promise.prototype["catch"]=function(e){return this.fail(e)},angular.module("service.parse",["constants","parse-angular"]).factory("ParseService",["$q","$log","parseAppId","serverUrl","parseMount",function(e,t,n,o,r){function i(e){var t={};t.id=e.authResponse.userID,t.access_token=e.authResponse.accessToken;var n=new Date;return n.setSeconds(n.getSeconds()+e.authResponse.expiresIn),t.expiration_date=n.toISOString(),t}function a(){}function s(e,t){var n=e;return Parse.User.signUp(n,t,{email:e}).then(function(e){return h(),e},function(e){return Parse.Promise.error(e)})}function l(e,t){return Parse.User.logIn(e,t).then(function(e){return h(),e},function(e){return Parse.Promise.error(e)})}function c(e){return Parse.FacebookUtils.logIn(i(e)).then(function(e){return h(),e})}function u(e){return Parse.Cloud.run("LoadLinkedInMember",{authData:e}).then(function(e){return Parse.User.become(e)})["catch"](Ae)}function d(){return Parse.Cloud.run("CopyFacebookProfile")["catch"](Ae)}function f(){return h(),Parse.User.current()}function g(){return Parse.Cloud.run("RebuildMatches")["catch"](Ae)}function p(){return Parse.Cloud.run("GetTwilioToken")["catch"](Ae)}function h(){if("undefined"!=typeof ParsePushPlugin){ParsePushPlugin.getInstallationId(function(e){return t.log("Parse Push InstallationId "+e)},function(e){return t.error("ParsePushPlugin getInstallationId error "+e)});var e="user_"+Parse.User.current().id;ParsePushPlugin.subscribe(e,function(){return t.log("Subscribed to parse push channel "+e)},function(e){return t.error("Parse Push subscribe error "+e)}),ParsePushPlugin.on("receivePN",function(e){return onNotification(e)}),ParsePushPlugin.on("openPN",function(e){return onNotificationOpen(e)})}}function m(e,t){if(e&&!t)throw"product must be provided if setting premium to true";return Parse.Cloud.run("SetPremium",{premium:e,product:t})["catch"](Ae)}function v(e){if(!e)throw"product must be provided";return Parse.Cloud.run("SetPremium",{premium:premium,product:e})["catch"](Ae)}function S(){return Parse.User.current().fetch()}function y(e){return e.fetch()}function E(e){return e||null==Parse.User.current()||(e=Parse.User.current().getEmail()),Parse.User.requestPasswordReset(e)}function P(){return Parse.User.current().id}function b(){var e=Parse.User.current(),n=e.profile;return n?n.fetch():(t.debug("Calling LinkProfileToUser"),Parse.Cloud.run("LinkProfileToUser").then(function(t){return t=Pe(t,"Profile"),e.profile=t,t})["catch"](Ae))}function A(e){return Parse.Cloud.run("GetProfileOfSelectedUser",{profileId:e}).then(function(e){return e=Pe(e,"Profile")})["catch"](Ae)}function T(e){return Parse.Cloud.run("GetProfileForMatch",{matchId:e}).then(function(e){return Pe(e,"Profile")})["catch"](Ae)}function C(e,t){return new Parse.GeoPoint({latitude:Math.round(100*e)/100,longitude:Math.round(100*t)/100})}function M(e,t){var n={notifyMatch:t.notifyMatch,notifyMessage:t.notifyMessage,distanceType:t.distanceType,distance:t.distance};return e.save(n)}function w(e,t){return t&&t.location&&(t.location=C(t.location.latitude,t.location.longitude)),t&&t.photos&&(t.photos=_.map(t.photos,function(e){return{name:e.name,url:e.url(),__type:"File"}})),t&&t.photosInReview&&(t.photosInReview=_.map(t.photosInReview,function(e){return{name:e.name,url:e.url(),__type:"File"}})),e.save(t)}function R(e,t){return Parse.Cloud.run("SaveProfileForApplyBadge",{id:e.id,profileChanges:t})["catch"](Ae)}function O(e,n){var o=new Parse.File(e,{base64:n});return t.log("saving file "+e),o.save()}function I(e,t,n){return Parse.Cloud.run("ProcessMatch",{otherUserId:e.uid,liked:t,forceConnect:n}).then(function(e){return Pe(e,"Match")})["catch"](Ae)}function U(e,t){return Parse.Cloud.run("ProcessPregnancy",{otherUserId:e.uid,impregnate:t}).then(function(e){return Pe(e,"Match")})["catch"](Ae)}function N(e){e||t.error("search parameters were not provided");for(var n={},o=0;o<profileFields.length;o++)n[profileFields[o]]=e[profileFields[o]];return Parse.Cloud.run("GetMatches",n)["catch"](Ae)}function L(t){return 0===t.length?e.when([]):Parse.Cloud.run("GetMutualMatches",{matchIds:t}).then(function(e){return _.map(e,function(e){var t=Pe(e.otherProfile,"Profile");return e=Pe(e,"Match"),e.otherProfile=t,e})})["catch"](Ae)}function F(){return Parse.Cloud.run("GetProfilesWhoLikeMe")["catch"](Ae)}function D(){return Parse.Cloud.run("GetProfilesWhoWantsToHaveARelationshipWithMe")["catch"](Ae)}function k(e){var t=new Parse.Query("ChatMessage"),n=Match.createWithoutData(e);return t.equalTo("match",n.toPointer()),t.ascending("createdAt"),t.limit(1e3),t.find()}function $(e){var t=new Parse.Query("ChatMessage");return t.equalTo("userIds",P()),e&&t.greaterThan("createdAt",e),t.ascending("createdAt"),t.limit(1e3),t.find()}function B(e,n,o){return n&&o&&t.error("Can only attach one of image or audio"),n?new Parse.File("chat.png",{base64:n}).save().then(function(t){return e.image=t,e.save()}):o?(t.log("saving audio file"),new Parse.File("chat.m4a",{base64:o}).save().then(function(t){return e.audio=t,e.save()})):e.save()}function G(e){return Parse.Cloud.run("RemoveMatch",{matchId:e})["catch"](Ae)}function V(e,t,n){var o=new Report;return o.reportedBy=P(),o.reportedUser=t.uid,o.profile=t,o.reason=e,o.match=n,o.save()}function H(e){e||t.error("search parameters were not provided");for(var n={},o=0;o<profileFields.length;o++)n[profileFields[o]]=e[profileFields[o]];return Parse.Cloud.run("GetProfilesSpecial",n)["catch"](Ae)}function x(){return Parse.Cloud.run("DeleteUnmatched")["catch"](Ae)}function J(e){var t=new ContactMessage;return t.message=e,t.save()}function W(){}function j(){return Parse.Cloud.run("DeleteAccount")["catch"](Ae)}function q(){return"undefined"!=typeof ParsePushPlugin&&Parse.User.current()&&ParsePushPlugin.unsubscribe("user_"+Parse.User.current().id,function(e){t.log("ParsePush unsubscribed")},function(e){t.log("ParsePush unsubscribe error "+e)}),Parse.User.logOut()}function Q(){return Parse.Cloud.run("TestPushNotification")["catch"](Ae)}function Y(){return Parse.Cloud.run("GetReportedUsers").then(function(e){return _.map(e,be)})["catch"](Ae)}function K(){return Parse.Cloud.run("GetBannedUsers").then(function(e){return _.map(e,be)})["catch"](Ae)}function z(){return Parse.Cloud.run("GetApplyBadgeUsers").then(function(e){return _.map(e,function(e){var t=Pe(e,"Profile");return t})})["catch"](Ae)}function Z(e){return Parse.Cloud.run("GetReportedUserDetails",{reportedBy:e.reportedBy.id,reportedUser:e.reportedUser.id}).then(function(e){return be})["catch"](Ae)}function X(e,t){return Parse.Cloud.run("DeletePhoto",{reportId:e,photoUrl:t})["catch"](Ae)}function ee(e){return Parse.Cloud.run("BanUser",{userId:e})["catch"](Ae)}function te(e,t){return Parse.Cloud.run("CloseReport",{reportId:e,action:t})["catch"](Ae)}function ne(e){return Parse.Cloud.run("SearchUsersByEmail",{email:e})["catch"](Ae)}function oe(e){return Parse.Cloud.run("SearchUsersByName",{name:e})["catch"](Ae)}function re(e){return Parse.Cloud.run("LoadUser",{userId:e})["catch"](Ae)}function ie(e){return Parse.Cloud.run("DeleteUser",{userId:e})["catch"](Ae)}function ae(){return Parse.Cloud.run("GetProfilesWithPhotosToReview").then(function(e){return _.map(e,be)})["catch"](Ae)}function se(e,t,n){return Parse.Cloud.run("ReviewPhoto",{profileId:e,fileUrl:t,approved:n})["catch"](Ae)}function le(e){return Parse.Cloud.run("AddClinicsQuestion",{clinicQuestion:e})["catch"](Ae)}function ce(){return Parse.Cloud.run("GetClinicsQuestion")["catch"](Ae)}function ue(e){return Parse.Cloud.run("DelClinicsQuestion",{id:e})["catch"](Ae)}function de(e){return Parse.Cloud.run("AddFindUs",{findUs:e})["catch"](Ae)}function fe(){return Parse.Cloud.run("GetFindUs")["catch"](Ae)}function ge(e){return Parse.Cloud.run("DelFindUs",{id:e})["catch"](Ae)}function pe(e){return Parse.Cloud.run("AddFindUsReport",{findUsVotes:e})["catch"](Ae)}function he(){return Parse.Cloud.run("GetFindUsReport")["catch"](Ae)}function me(e){return Parse.Cloud.run("DelFindUsReport",{id:e})["catch"](Ae)}function ve(e){return Parse.Cloud.run("AddAboutJab",{about:e})["catch"](Ae)}function Se(){return Parse.Cloud.run("GetAboutJab")["catch"](Ae)}function ye(e){return Parse.Cloud.run("GetMatchesReport",{numDays:e})["catch"](Ae)}function Ee(e){return Parse.Cloud.run("GetChatMessageReport",{numDays:e})["catch"](Ae)}function Pe(e,n){return e?(e.className=n,Parse.Object.fromJSON(e)):(t.debug("fromJSON object is null for "+n),null)}function be(e){return e.id=e.objectId,e}function Ae(n){if(t.debug("unwrapping "+JSON.stringify(n)),141===n.code){if(_.isNumber(n.message.code))n=n.message;else if(_.isString(n.message)&&n.message.startsWith("{"))try{return n=JSON.parse(n.message),e.reject(n)}catch(o){t.debug("Error parsing unwrapped error "+o)}"function not found"==n.message&&t.error("Cloud function not found. Is the latest Cloud Code deployed?")}return e.reject(n)}t.log("Initializing Parse at "+o+r+"  App Id:"+n),Parse.initialize(n,"unused"),Parse.serverURL=o+r;var Te={init:a,facebookLogin:c,linkedInLogin:u,signUp:s,logIn:l,autoLogin:f,registerPush:h,getTwilioToken:p,rebuildMatches:g,setPremium:m,addCredits:v,reloadUser:S,reloadProfile:y,requestPasswordReset:E,copyFacebookProfile:d,getUserId:P,getProfile:b,getProfileOfSelectedUser:A,getProfileForMatch:T,convertLocation:C,saveSettings:M,saveProfile:w,saveProfileForApplyBadge:R,saveFile:O,searchProfiles:N,getProfilesWhoLikeMe:F,getProfilesWhoWantsToHaveARelationshipWithMe:D,processProfile:I,processPregnancy:U,deleteUnmatched:x,getMatches:L,getChatMessages:k,loadChatMessages:$,sendChatMessage:B,removeMatch:G,reportProfile:V,sendContactMessage:J,resetBadge:W,logout:q,deleteAccount:j,testPushNotification:Q,getReportedUsers:Y,getBannedUsers:K,getApplyBadgeUsers:z,getReportedUserDetails:Z,deletePhoto:X,banUser:ee,closeReport:te,getProfilesWithPhotosToReview:ae,reviewPhoto:se,searchUsersByEmail:ne,searchUsersByName:oe,loadUser:re,deleteUser:ie,addClinicsQuestion:le,getClinicsQuestion:ce,delClinicsQuestion:ue,getFindUs:fe,addFindUs:de,delFindUs:ge,addFindUsReport:pe,getFindUsReport:he,delFindUsReport:me,addAboutJab:ve,getAboutJab:Se,getMatchesReport:ye,getChatMessageReport:Ee,getProfileNew:H};return Te}]),function(){angular.module("service.localdb",[]).factory("LocalDB",["$q","$log","appName","env",function(t,n,o,r){function i(e){return JSON.stringify({code:e.code,message:e.message})}function a(e){for(var t=e.rows.length,n=[],o=0;o<t;o++){var r=e.rows.item(o),i=JSON.parse(r.match);i.className="Match",i.updatedAt={__type:"Date",iso:new Date(r.updated_at).toISOString()};var a=Parse.Object.fromJSON(i);a.lastMessage=r.last_message,a.read=1===r.read,n.push(a)}return n}function s(e){for(var t=e.rows.length,n=[],o=0;o<t;o++){var r=e.rows.item(o),i=JSON.parse(r.chat_message);i.className="ChatMessage";var a=Parse.Object.fromJSON(i);n.push(a)}return n}function l(e){for(var t=e.rows.length,n=[],o=0;o<t;o++){var r=e.rows.item(o),i=JSON.parse(r.profile);i.className="Profile";var a=Parse.Object.fromJSON(i);n.push(a)}return n}function c(){var e=o+"-"+r;window.sqlitePlugin?P=window.sqlitePlugin.openDatabase({name:e+".db",iosDatabaseLocation:"default"},function(){return n.info("Opened sqlite database "+e)},function(e){return n.error("Error opening sqlite database "+JSON.stringify(e))}):(n.debug("Opening HTML5 database"),P=window.openDatabase(e,"","LocalDB",2097152));var i=new E(P);return i.migration(1,function(e){e.executeSql("CREATE TABLE profile (id varchar primary key, profile text, user_id varchar)"),e.executeSql("CREATE TABLE match (id varchar primary key, match text, other_user_id varchar, other_profile_id varchar, updated_at integer, last_message varchar, read integer)"),e.executeSql("CREATE TABLE chat_message (id varchar primary key, chat_message text, chat_id varchar, created_at integer)"),e.executeSql("CREATE INDEX chat_message_chat_id ON chat_message (chat_id)")}),i.execute().then(function(){return t.when()})}function u(){n.log("Deleting database data");var e=t.defer();return P.transaction(function(e){e.executeSql("DELETE FROM match"),e.executeSql("DELETE FROM profile"),e.executeSql("DELETE FROM chat_message")},function(t){n.error("Error delete database data: "+t.message),e.reject(i(t))},function(){n.log("Database data deleted"),e.resolve()}),e.promise}function d(){var e=t.defer();return P.readTransaction(function(t){t.executeSql("SELECT * FROM match ORDER BY updated_at DESC",[],function(t,n){e.resolve(a(n))})},function(t){e.reject(i(t))}),e.promise}function f(){var e=t.defer();return P.readTransaction(function(t){t.executeSql("SELECT * FROM profile",[],function(t,n){e.resolve(l(n))})},function(t){e.reject(i(t))}),e.promise}function g(e,o){var r=t.defer();e.profile=o;var a=e.toJSON();return a.otherProfileId=o.id,delete a.otherProfile,P.transaction(function(t){t.executeSql("INSERT OR REPLACE INTO match (id, match, other_user_id, other_profile_id, updated_at, read) VALUES (?,?,?,?,?,?)",[e.id,JSON.stringify(a),o.uid,o.id,e.updatedAt.getTime(),0]),t.executeSql("INSERT OR REPLACE INTO profile (id, profile, user_id) VALUES (?,?,?)",[o.id,JSON.stringify(o.toJSON()),o.uid])},function(e){r.reject(i(e)),n.error("Error saving match: "+e.message)},function(){r.resolve()}),r.promise}function p(e){var o=t.defer();return P.transaction(function(t){t.executeSql("INSERT OR REPLACE INTO profile (id, profile, user_id) VALUES (?,?,?)",[e.id,JSON.stringify(e),e.uid])},function(e){o.reject(i(e)),n.error("Error saving profile: "+e.message)},function(){o.resolve()}),o.promise}function h(e){var o=t.defer();return P.transaction(function(t){t.executeSql("DELETE FROM match WHERE id=?",[e]),t.executeSql("DELETE FROM chat_message WHERE chat_id=?",[e])},function(e){o.reject(i(e)),n.error("LocalDB Error deleting match: "+e.message)},function(){o.resolve()}),o.promise}function m(e){var n=t.defer();return P.readTransaction(function(t){t.executeSql("SELECT * FROM chat_message WHERE chat_id = ? ORDER BY created_at ASC",[e],function(e,t){n.resolve(s(t))})},function(e){n.reject(i(e))}),n.promise}function v(e){var o=t.defer(),r=!1,a=e.toJSON();return P.transaction(function(t){t.executeSql("INSERT OR IGNORE INTO chat_message (id, chat_message, chat_id, created_at) VALUES (?,?,?,?)",[e.id,JSON.stringify(a),e.match.id,e.createdAt.getTime()],function(e,t){r=t.rowsAffected>0}),t.executeSql("UPDATE match SET updated_at = ?, last_message = ? WHERE id = ? and ? > updated_at",[e.createdAt.getTime(),e.lastMessage,e.match.id,e.createdAt.getTime()]),b.userId!==e.sender&&r?t.executeSql("UPDATE match SET read = 0 WHERE EXISTS (SELECT 1 FROM chat_message WHERE id = ?)",[e.id]):b.userId===e.sender||r||t.executeSql("UPDATE match SET read = 0 WHERE NOT EXISTS (SELECT 1 FROM chat_message WHERE id = ?)",[e.id])},function(e){o.reject(i(e)),n.error("Error saving chat message: "+e.message)},function(){n.debug("saved chat message new:"+r),o.resolve(r)}),o.promise}function S(e,o){if(!_.isBoolean(o))throw"read must be a boolean. Was "+o;var r=o?1:0,a=t.defer();return P.transaction(function(t){t.executeSql("UPDATE match SET read = ? WHERE id = ?",[r,e])},function(e){a.reject(i(e)),n.error("Error updating read flag: "+e.message)},function(){a.resolve()}),a.promise}function y(){var e=t.defer();return P.readTransaction(function(t){t.executeSql("SELECT * FROM match WHERE read = 0",[],function(t,n){for(var o=n.rows.length,r={},i=0;i<o;i++){var a=n.rows.item(i);r[a.id]=!0}e.resolve(r)})},function(t){e.reject(i(t))}),e.promise}function E(o){function r(a){var s=t.defer();return c[a]?o.transaction(function(t){t.executeSql("update "+d+" set version = ?",[a],function(e){n.info("Beginning migration "+a),c[a](e),n.info("Completed migration "+a),r(a+1).then(function(){return s.resolve()})},function(t,o){n.error("Error!: %o (while upgrading to %s from %s)",o.message,a),s.reject(i(e))})}):(n.debug("Migrations complete."),u=2,s.resolve()),s.promise}function a(e){u=1,n.debug("Main Migrator starting");var o=t.defer();try{return r(e+1).then(function(){return o.resolve()})}catch(i){o.reject(i)}return o.promise}function s(){var r=t.defer();return n.log("Ensuring migration table exists"),o.transaction(function(t){t.executeSql("create table if not exists "+d+" (version integer)",[],function(e,t){return r.resolve()},function(t,n){return r.reject("Error creating version table"+i(e))})}),r.promise}function l(){var e=t.defer();return n.log("Checking for existing migration version"),o.transaction(function(t){t.executeSql("SELECT VERSION FROM "+d,[],function(o,r){return r.rows.length>0?e.resolve(r.rows.item(0).version):(n.log("Inserting default migration version"),void t.executeSql("INSERT INTO "+d+" values(0)",[],function(t,n){e.resolve(0)},function(t,n){return e.reject("Error ensuring default version "+i(n))}))},function(t,n){return e.reject("Error selecting version "+i(n))})}),e.promise}var c=[],u=0,d="version";this.migration=function(e,t){c[e]=t},this.execute=function(){if(u>0)throw"Migrator is only valid once -- create a new one if you want to do another migration.";return s().then(function(){return l()}).then(function(e){return a(e)})["catch"](function(e){return n.error("SQL DB init error:",e)})}}var P,b={userId:"",init:c,getMatches:d,saveMatch:g,deleteMatch:h,getChatMessages:m,saveChatMessage:v,setChatRead:S,getUnreadChats:y,getProfiles:f,saveProfile:p,deleteDb:u};return b}])}(),angular.module("ionicApp").config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("signin",{url:"/sign-in",templateUrl:"sign-in.html",controller:"SignInCtrl"}).state("emailVerification",{url:"/emailVerification",templateUrl:"emailVerification.html",controller:"EmailVerificationCtrl"}).state("profileSetup",{url:"/profileSetup",templateUrl:"profileSetup.html",controller:"ProfileSetupCtrl"}).state("walkthru",{url:"/walkthru",templateUrl:"introWalkthrough.html",controller:"WalkThruCtrl"}).state("findUs",{url:"/findUs",templateUrl:"findUs.html",controller:"FindUsCtrl",params:{username:null}}).state("locationSetup",{url:"/locationSetup",templateUrl:"locationSetup.html",controller:"LocationSetupCtrl"}).state("termsOfUse",{url:"/termsOfUse",templateUrl:"termsOfUse.html",controller:"TermsOfUseCtrl"}).state("banned",{templateUrl:"banned.html"}).state("menu",{url:"/menu","abstract":!0,templateUrl:"menu.html"}).state("menu.home",{url:"/home",views:{menuContent:{templateUrl:"profile-search.html",controller:"ProfileSearch"}}}).state("menu.sharevidhome",{url:"/sharevidhome",views:{menuContent:{templateUrl:"sharevidhome.html",controller:"ShareVidHomeCtrl"}}}).state("menu.sharevidupload",{url:"/sharevidupload",views:{menuContent:{templateUrl:"sharevidupload.html",controller:"ShareVidUploadCtrl"}}}).state("menu.search-profile-view",{url:"/search-profile-view",views:{menuContent:{templateUrl:"search/search-profile-view.html"}},params:{profile:null}}).state("menu.match-profile",{url:"/match-profile/:matchId/:profileId",views:{menuContent:{templateUrl:"matchProfile.html",controller:"MatchProfileCtrl"}},resolve:{matchProfile:["AppService","$stateParams",function(e,t){return t.matchId?e.getProfileByMatchId(t.matchId):t.profileId?e.getProfileById(t.profileId):void 0}]}}).state("menu.chats",{url:"/chats",views:{menuContent:{templateUrl:"chats.html",controller:"ChatsCtrl"}}}).state("menu.chat",{url:"/chat/:matchId",views:{menuContent:{templateUrl:"chat.html",controller:"ChatCtrl"}}}).state("menu.likedMe",{url:"/likedMe",views:{menuContent:{templateUrl:"likedMe.html",controller:"LikedMe"}}}).state("menu.relationship",{url:"/relationship",views:{menuContent:{templateUrl:"relationship.html",controller:"RelationshipCtrl"}}}).state("menu.profile",{url:"/profile",views:{menuContent:{templateUrl:"profile/profile-view-current-user.html",controller:"ProfileViewCurrentUser"}}}).state("menu.profile-edit",{url:"/profile-edit",views:{menuContent:{templateUrl:"profile/profile-edit.html"}}}).state("menu.fb-albums",{url:"/fb-albums",views:{menuContent:{templateUrl:"fbAlbums.html",controller:"FbAlbumsCtrl"}}}).state("menu.fb-album",{url:"/fb-album/:albumId",views:{menuContent:{templateUrl:"fbAlbum.html",controller:"FbAlbumCtrl"}}}).state("menu.crop",{url:"/crop",views:{menuContent:{templateUrl:"crop.html",controller:"PhotoCropCtrl"}}}).state("menu.discovery",{url:"/discovery",views:{menuContent:{templateUrl:"discovery.html",controller:"DiscoveryCtrl"}}}).state("menu.location",{url:"/location",views:{menuContent:{templateUrl:"locationMap.html",controller:"LocationCtrl"}}}).state("menu.clinics",{url:"/clinics",views:{menuContent:{templateUrl:"clinics.html",controller:"ClinicsCtrl"}}}).state("menu.about",{url:"/about",views:{menuContent:{templateUrl:"about.html",controller:"AboutCtrl"}}}).state("menu.settings",{url:"/settings",views:{menuContent:{templateUrl:"settings.html",controller:"SettingsCtrl"}}}).state("menu.contact",{url:"/contact",views:{menuContent:{templateUrl:"contact.html",controller:"ContactCtrl"}}}),t.otherwise("/sign-in")}]),app.config(["$provide",function(e){var t=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor);t&&e.decorator("$rootScope",["$delegate",function(e){var t=Object.getPrototypeOf(e),n=t.$new;return t.$new=function(){try{return n.apply(this,arguments)}catch(e){throw console.error(e),e}},e}])}]),angular.module("controllers",["service.app","ngAnimate","ngCordova","ionic.contrib.ui.tinderCards"]).controller("SignInCtrl",["$scope","$log","$rootScope","$state","$http","$timeout","$cordovaFacebook","$q","$ionicPopup","$ionicModal","$ionicLoading","$ionicHistory","AppService","AppUtil","SocialAuth","linkedInId","linkedInSecret",function(e,t,n,o,r,i,a,s,l,c,u,d,f,g,p,h,m){function v(){e.showForm=!0,e.showLogo=!1,e.logo["class"]="",e.status=""}function S(){e.showForm=!1,e.showLogo=!0,e.logo["class"]="animated jello infinite",e.status=""}function y(){return P()||E()}function E(){return e.credentials.password.length<6&&(g.toastSimpleTranslate("PASSWORD_LENGTH"),!0)}function P(){var t=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return!t.test(e.credentials.email)&&(g.toastSimpleTranslate("INVALID_EMAIL"),!0)}function b(n){t.log("checkProfile()");var o=n?s.when(n):f.loadProfile();f.requestLocationServices().then(function(){return o}).then(function(t){return t?t.gps?(e.status="WAITING_FOR_GPS",f.getCurrentPosition().then(function(e){return e},function(e){return null})):null:s.reject("Unable to load Profile")}).then(function(e){var n=f.getProfile();return n.gps===!1||null===e?void A(n):(t.log("updating location to "+JSON.stringify(e)),void f.saveProfile({location:e})["finally"](function(){return A(n)}))},function(e){return v(),f.logout(),t.error("Error loging in: "+JSON.stringify(e)),209===e.code?void g.toastSimple("Invalid session. Try again"):void g.toastSimpleTranslate("LOGIN_ERROR")})}function A(){e.status="",e.logo["class"]="animated zoomOutDown",f.getMutualMatches(),d.nextViewOptions({historyRoot:!0,disableBack:!0}),i(function(){return f.goToNextLoginState()},1e3)}function T(e){platformReady&&(window.cordova||!FACEBOOK_APP_ID||fbJsSdkLoaded)?e&&i(e,50):(console.debug("Waiting for Facebook Javascript SDK to load"),i(function(){T(e)},250))}e.credentials={email:"",password:""},e.logo={"class":""},e.showForm=!1,e.showLogo=!1,e.showResetPassword=!1,e.showResetPasswordForm=function(){e.showForm=!1,e.showResetPassword=!0},e.hideResetPasswordForm=function(){e.showForm=!0,e.showResetPassword=!1},e.resetPassword=function(){P()||g.blockingCall(f.requestPasswordReset(e.credentials.email),function(){e.hideResetPasswordForm(),g.toastSimpleTranslate("PASSWORD_RESET_SENT")})},e.emailRegister=function(){y()||(S(),f.signUp(e.credentials.email,e.credentials.password).then(function(e){t.log("user signed up success"),b()},function(e){v(),t.error("user signed up error "+JSON.stringify(e)),setTimeout(function(){return g.toastSimple(e.message)},10)}))},e.emailLogin=function(){y()||(S(),f.logIn(e.credentials.email,e.credentials.password).then(function(e){t.log("user login success"),b()},function(e){v(),e.code&&101===e.code?(g.toastSimpleTranslate("INVALID_EMAIL_PASSWORD"),t.warn(JSON.stringify(e))):(g.toastSimpleTranslate("LOGIN_ERROR"),t.error(JSON.stringify(e)))}))},e.linkedInLogin=function(){S(),e.status="LOGGING_IN_TO_LINKEDIN",p.linkedIn(h,m,["r_basicprofile","r_emailaddress"],"rtbwrtusgfxytr").then(function(e){return f.linkedInLogin(e)}).then(function(){return b(null)},function(e){v(),e.code&&203===e.code?(g.toastSimple(e.message),t.warn(JSON.stringify(e))):(g.toastSimple("LinkedIn login failed"),t.error(JSON.stringify(e))),f.logout()})},e.facebookLogin=function(){S(),e.status="LOGGING_IN_TO_FB",C().then(function(e){return f.facebookLogin(e)}).then(function(t){return e.status="LOADING_PROFILE",f.loadProfile()}).then(function(n){return n.name?n:(t.log("Initialising profile with facebook profile"),e.status="LOADING_FB_PROFILE",f.copyFacebookProfile())}).then(function(){return b()},e._handleFacebookLoginError)},e._handleFacebookLoginError=function(e){return v(),e.code&&"MINIMUM_AGE_ERROR"===e.code?void l.alert({title:"Error",template:"You do not meet the age requirements for this app."}).then(function(){return f.logout()}):(t.error("Facebook login error: "+JSON.stringify(e)),f.logout(),void g.toastSimpleTranslate("LOGIN_ERROR"))};var C=function(){var o=s.defer();return e.status="LOGGING_IN_TO_FB",a.getLoginStatus().then(function(e){"connected"===e.status?(t.log("setting $rootScope.facebookConnected"),
n.facebookConnected=!0,n.fbAccessToken=e.authResponse.accessToken,o.resolve(e)):(t.log("$cordovaFacebook.login"),a.login(["public_profile","email","user_birthday","user_photos","user_friends","user_likes"]).then(function(e){"connected"===e.status?(t.log("setting $rootScope.facebookConnected"),n.facebookConnected=!0,n.fbAccessToken=e.authResponse.accessToken,o.resolve(e)):o.reject(e)},function(e){return o.reject(e)}))},function(e){o.reject(e)}),o.promise},M=function(){null!=Parse.User.current()?(t.log("auto login"),S(),f.autoLogin(),Parse.FacebookUtils.isLinked(Parse.User.current())?(t.log("Checking facebook user"),C().then(function(e){b(null)},function(e){v(),g.toastSimple("Facebook login error"),t.error("Facebook login error "+JSON.stringify(e))})):b(null)):v()};T(M)}]),angular.module("controllers").controller("ProfileSearch",["$log","$scope","$state","$timeout","$translate","$ionicSideMenuDelegate","TDCardDelegate","AppService","AppUtil","$ionicModal","$ionicPopup",function(e,t,n,o,r,i,a,s,l,c,u){function d(){var n=Date.now();s.updateProfileSearchResults().then(function(r){e.log("CardsCtrl: found "+r.length+" profiles"),t.noOneAround=!r.length,r.map(function(e){return e.image=e.photoUrl});var i=Date.now()-n;i<p?o(function(){return t.profiles=r},p-i):t.profiles=r},function(n){e.log("updateProfileSearchResults error "+JSON.stringify(n)),t.profiles=[],l.toastSimple(f.MATCHES_LOAD_ERROR)})}var f;r(["MATCHES_LOAD_ERROR"]).then(function(e){f=e}),t.profiles=null,t.noOneAround=!1;var g=t.profile=s.getProfile();t.profilePhoto=g.photoUrl,t.deleteUnmatchedSwipes=function(){return l.blockingCall(s.deleteUnmatched(),function(t){return e.log(t)},function(t){return e.error(t)})},t.$on("$ionicView.enter",function(){g.enabled&&(t.profiles=s.getProfileSearchResults(),t.profiles&&0!==t.profiles.length||t.searchAgain())}),t.$on("newProfileSearchResults",function(){return t.profiles=s.getProfileSearchResults()}),t.searchAgain=function(){t.profiles=null,t.noOneAround=!1,d()};var p=2e3;c.fromTemplateUrl("newMatch.html",{scope:t,animation:"slide-in-up"}).then(function(e){return t.modal=e}),t.$on("$destroy",function(){return t.modal.remove()}),t.$on("newMatch",function(n,o){e.log("CardsCtrl.newMatch "+o.id),t.newMatch=o,t.matchProfile=s.getProfileById(o.profileId),t.modal.show()}),t.closeNewMatch=function(){return t.modal.hide()},t.messageNewMatch=function(){t.modal.hide(),n.go("^.chat",{matchId:t.newMatch.id})},t.openNewMatch=function(){t.newMatch=s.getMutualMatches()[0],t.modal.show()},t.enableDiscovery=function(){l.blockingCall(s.enableDiscovery(),function(){e.log("discovery enabled. updating search results..."),d()})},t.viewDetails=function(t){e.log("view details "+JSON.stringify(t)),n.go("^.search-profile-view",{profile:t})},t.accept=function(){e.log("accept button");var n=t.profiles[t.profiles.length-1];s.processMatch(n,!0),n.accepted=!0,o(function(){return t.profiles.pop()},340)},t.reject=function(){e.log("reject button");var n=t.profiles[t.profiles.length-1];s.processMatch(n,!1),n.rejected=!0,o(function(){return t.profiles.pop()},340)},t.cardDestroyed=function(e){return t.profiles.splice(e,1)},t.cardTransitionLeft=function(e){s.processMatch(e,!1),0==t.profiles.length},t.cardTransitionRight=function(e){s.processMatch(e,!0),0==t.profiles.length}}]).controller("MatchProfileCtrl",["$scope","$translate","AppService","AppUtil","$state","$stateParams","$ionicHistory","$ionicActionSheet","$ionicPopup","matchProfile",function(e,t,n,o,r,i,a,s,l,c){function u(){o.blockingCall(n.processPregnancy(e.matchProfile,!0),function(){o.toastSimple("Confirmation Request Sent!")})}var d;t(["REQUEST_FAILED","REPORT","MATCH_OPTIONS","CANCEL","WANT_TO_REMOVE_MATCH","MATCH_REPORTED"]).then(function(e){d=e}),e.matchProfile=c,e.profileOptions=function(){l.show({title:"Match Options",subTitle:"Press send to confirm with your potential co-parent that you have agreed to try for a baby with each other. Donât worry, itâs not legally binding. This will be the beginning of your journey. From here we will guide you through best practices around having a                         baby. This feature also aims to reduce the chance of what we call the Genghis Kahn effect. The Kahn family is thought to have over 30 million descendants. We encourage you to use this feature to better inform yourself and others. Best to be open and honest, weâre dealing                     with potential family.",cssClass:"popup-vertical-buttons",buttons:[{text:"We have agreed to try for a baby",type:"button-positive",onTap:function(e){u()}},{text:"Cancel",type:"button-assertive text-color-white",onTap:function(e){o.toastSimple("No Confirmation Request has been Sent")}}]})}}]),angular.module("controllers").controller("EmailVerificationCtrl",["$scope","AppService","AppUtil",function(e,t,n){e.isEmailVerified=function(){return n.blockingCall(t.isEmailVerified(),function(e){return e?t.goToNextLoginState():n.toastSimpleTranslate("EMAIL_NOT_VERIFIED")})},e.cancel=function(){return t.logout()}}]).controller("ClinicsCtrl",["$scope","AppService","AppUtil","$ionicPopover","$localStorage","$sce",function(e,t,n,o,r,i){function a(){e.showcase=r.clinicSettings,console.log("ClinicsCtrl update()"+e.showcase)}e.clinicQuestions=null,e.showcase="General",e.$on("$ionicView.beforeEnter",function(){return e.refreshClinics()}),e.$on("clinicsUpdated",function(){a()}),e.refreshClinics=function(){r.clinicSettings="General",n.blockingCall(t.getClinicsQuestion(),function(t){console.log("loaded "+t.length+" questions"),e.clinicQuestions=t})},e.clinicSettings=function(t){var n='<ion-popover-view style="height: 250px;"><ion-header-bar><h1 class="title">FAQ Settings</h1></ion-header-bar><ion-content><clinic-settings/></ion-content></ion-popover-view>';e.popover=o.fromTemplate(n,{scope:e}),e.popover.show(t),e.closePopover=function(){return e.popover.hide()},e.$on("$destroy",function(){return e.popover.remove()})},e.trustSrcurl=function(e){if(e)return i.trustAsResourceUrl("https://www.youtube.com/embed/"+e)}}]).directive("clinicSettings",["$localStorage","$rootScope",function(e,t){return{restrict:"E",scope:{},template:'<ion-list><div class="item item-divider">Show Questions by:</div><ion-radio ng-model="settings" ng-click="showItem(\'General\')" ng-value="\'General\'">General</ion-radio><ion-radio ng-model="settings" ng-click="showItem(\'Male\')" ng-value="\'Male\'">Male</ion-radio><ion-radio ng-model="settings" ng-click="showItem(\'Female\')" ng-value="\'Female\'">Female</ion-radio></ion-list>',controller:["$scope",function(n){n.settings=e.clinicSettings||"General",n.showItem=function(n){e.clinicSettings=n,t.$broadcast("clinicsUpdated")}}]}}]).controller("AboutCtrl",["$scope","AppService","AppUtil","$sce","$ionicModal",function(e,t,n,o,r){e.$on("$ionicView.beforeEnter",function(){return e.refreshAbout()}),e.refreshAbout=function(){n.blockingCall(t.getAboutJab(),function(t){e.about=t})},e.trustSrcurl=function(e){if(e)return o.trustAsResourceUrl("https://www.youtube.com/embed/"+e)}}]).controller("FindUsCtrl",["$scope","$stateParams","AppService","AppUtil","$ionicModal",function(e,t,n,o,r){e.$on("$ionicView.beforeEnter",function(){return e.refreshFindUs()}),e.findUsList=null,e.refreshFindUs=function(){o.blockingCall(n.getFindUs(),function(n){e.findUsList=[],console.log("loaded "+n.length+" find us group"),n.forEach(function(n){var o={name:"",username:"",checked:!1};o.name=n.name,o.username=t.username,e.findUsList.push(o)})})},e.skip=function(){n.goToNextLoginState()},e.done=function(){e.votes=e.findUsList.filter(function(e){return e.checked}),o.blockingCall(n.addFindUsReport(e.votes),function(){o.toastSimple("Thank You"),n.goToNextLoginState()})},r.fromTemplateUrl("introWalkthrough.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t,e.modal.show()}),e.closeModal=function(){e.modal.hide()}}]).controller("WalkThruCtrl",["$scope","AppService","AppUtil",function(e,t,n){e.closeModal=function(){t.goToNextLoginState()}}]).controller("ProfileSetupCtrl",["$scope","$state","$ionicHistory","AppService","AppUtil",function(e,t,n,o,r){e.$on("$ionicView.beforeEnter",function(t){var n=o.getProfile();n.name||o.logout();var r=null,i=null,a=null;n.birthdate&&(r=n.birthdate.getFullYear(),i=n.birthdate.getMonth(),a=n.birthdate.getDay()),e.user={name:n.name,birthYear:r,birthMonth:i,birthDay:a,gender:n.gender}}),e.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e.years=[];for(var i=(new Date).getFullYear()-100,a=(new Date).getFullYear()-13,s=i;s<=a;s++)e.years.push(s);e.yearFrom=i,e.yearTo=a,e.saveProfile=function(){if(!e.user.name||e.user.name.trim().length<1)return void r.toastSimpleTranslate("FIRST_NAME_REQUIRED");if(!e.user.birthDay)return void r.toastSimpleTranslate("BIRTH_DAY_REQUIRED");if(!e.user.birthMonth)return void r.toastSimpleTranslate("BIRTH_MONTH_REQUIRED");if(!e.user.birthYear)return void r.toastSimpleTranslate("BIRTH_YEAR_REQUIRED");if(!e.user.gender)return void r.toastSimpleTranslate("GENDER_REQUIRED");var t=new Date(Date.UTC(e.user.birthYear,e.user.birthMonth,e.user.birthDay)),n={name:e.user.name,birthdate:t,gender:e.user.gender,enabled:!0};r.blockingCall(o.saveProfile(n),function(){},"SETTINGS_SAVE_ERROR")},e.logout=function(){return o.logout()}}]).controller("LocationSetupCtrl",["$scope","$translate","AppService","AppUtil","$ionicPopup","$log",function(e,t,n,o,r,i){var a;t(["SETTINGS_SAVE_ERROR","GPS_ERROR","SET_MAP_LOCATION"]).then(function(e){a=e});var s=new google.maps.LatLng((-33.865143),151.2099),l={center:s,zoom:11,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1,disableDoubleClickZoom:!0},c=new google.maps.Map(document.getElementById("map"),l);e.map=c,c.setCenter(s);var u=new google.maps.Marker({position:s,map:c,title:"My Location",draggable:!0});google.maps.event.addListener(c,"click",function(e){u.setPosition(e.latLng)}),e.setLocation=function(){var e=u.getPosition();o.blockingCall(n.saveProfile({gps:!1,location:{latitude:e.lat(),longitude:e.lng()}}),function(){return n.goToNextLoginState()},"SETTINGS_SAVE_ERROR")},e.cancel=function(){return n.logout()},e.$on("$ionicView.afterEnter",function(e){r.alert({title:a.GPS_ERROR,template:a.SET_MAP_LOCATION})});var d=function(){i.log("Checking for current position"),n.getCurrentPosition().then(function(e){i.log("Found location "+JSON.stringify(e)),o.toastSimple("Location found from GPS"),o.blockingCall(n.saveProfile({gps:!1,location:{latitude:e.latitude,longitude:e.longitude}}),function(){return n.goToNextLoginState()},"SETTINGS_SAVE_ERROR")},function(e){i.log("Couldn't get location on resume "+e)})};e.$on("$ionicView.beforeEnter",function(e){d(),document.addEventListener("resume",d)}),e.$on("$ionicView.beforeLeave",function(e){document.removeEventListener("resume",d)})}]).controller("TermsOfUseCtrl",["$scope","AppService","AppUtil",function(e,t,n){e.agree=function(){return n.blockingCall(t.termsOfUseAgreed(),function(){return t.goToNextLoginState()})},e.logout=function(){return t.logout()}}]).controller("FbAlbumsCtrl",["$scope","$log","$cordovaFacebook",function(e,t,n){e.albums=null,n.api("/me/albums").then(function(t){e.albums=t.data},function(e){t.log("FbAlbumsController error "+JSON.stringify(e))})}]).controller("FbAlbumCtrl",["$log","$rootScope","$state","$scope","$stateParams","$ionicLoading","$cordovaFacebook",function(e,t,n,o,r,i,a){function s(e){var o=new Image;o.crossOrigin="anonymous",o.src=e,o.onload=function(){var e=document.createElement("canvas");e.width=this.width,e.height=this.height;var o=e.getContext("2d");o.drawImage(this,0,0);var r=e.toDataURL("image/png");t.cropPhoto=r,i.hide(),n.go("^.crop")}}a.api("/"+r.albumId+"/photos?fields=id,picture,source,height,width,images&limit=500").then(function(e){o.photos=e.data},function(t){e.log("FbAlbumController - error getting album photos "+JSON.stringify(t))}),o.selectPhoto=function(e){i.show({templateUrl:"loading.html"}),s(e.source)}}]).controller("PhotoCropCtrl",["$log","$scope","$rootScope","$ionicLoading","$state","$stateParams","$ionicHistory","AppService","AppUtil",function(e,t,n,o,r,i,a,s,l){t.myImage=n.cropPhoto,t.croppedImage={data:""},t.$on("$ionicView.afterLeave",function(e){n.cropPhoto=null}),t.cancel=function(){a.goBack()},t.crop=function(){o.show({templateUrl:"loading.html"});try{var n,r=t.croppedImage.data;n=r.split(",")[0].indexOf("base64")>=0?r.split(",")[1]:unescape(r.split(",")[1]),s.setPhoto(n).then(function(e){o.hide();var t=a.viewHistory();if("menu.fb-album"==t.backView.stateName){var n=t.histories[t.currentView.historyId];n.stack.splice(2,3),n.cursor=1,t.backView=n.stack[1],a.goBack()}else a.goBack()},function(t){o.hide(),e.error("Error saving cropped image "+JSON.stringify(t)),l.toastSimple("Error saving cropped image")})}catch(i){o.hide(),e.error("error getting cropped image data "+JSON.stringify(i)),l.toastSimple("Unable to crop image")}}}]).controller("SettingsCtrl",["$scope","$state","$ionicModal","$ionicPopup","AppService","AppUtil","$log","$rootScope","$translate","$ionicHistory","$ionicActionSheet","env",function(e,t,n,o,r,i,a,s,l,c,u,d){function f(){i.blockingCall(r.deleteAccount())}var g,p=["enabled","guys","girls","ageFrom","ageTo","distance","LFSperm","LFEggs","LFWomb","LFEmbryo","LFNot","LFHelpM","LFHelpO","LFSelfId"];l(["SETTINGS_SAVE_ERROR","DELETE","DELETE_ACCOUNT","CANCEL"]).then(function(e){g=e}),e.$on("$ionicView.enter",function(t){e.showDiscovery=!1}),e.profile=r.getProfile().clone(),e.showDiscovery=!0,e.showMI="mi"===e.profile.distanceType,e.showKM="km"===e.profile.distanceType;var h=e.profile.distanceType;e.setLanguage=function(e){a.log("setting language to "+e),l.use(e)},e.save=function(){h!=e.profile.distanceType&&"mi"==e.profile.distanceType?(e.profile.distance*=.621371,e.profile.distance=Math.floor(e.profile.distance)):h!=e.profile.distanceType&&"km"==e.profile.distanceType&&(e.profile.distance*=1.609344,e.profile.distance=Math.ceil(e.profile.distance)),h=e.profile.distanceType,i.blockingCall(r.saveSettings(e.profile),function(){return e.profile=r.getProfile().clone()}),i.blockingCall(r.saveProfile(_.pick(e.profile,p)),function(){r.clearProfileSearchResults(),c.nextViewOptions({historyRoot:!0,disableBack:!0}),t.go("menu.home")},"SETTINGS_SAVE_ERROR")},e.cancel=function(){e.profile=r.getProfile(e).clone()},e.logout=function(){r.logout()},e.inAppPurchasesAvailable=function(){return"undefined"!=typeof store},e.buyPro=function(){return store.order("pro version")},e.buySubscription=function(){return store.order("subscription")},e.testPushNotification=function(){return r.testPushNotification().then(function(e){return i.toastSimple("Sent")},function(e){return i.toastSimple(JSON.stringify(e))})},e.deleteUnmatchedSwipes=function(){return i.blockingCall(r.deleteUnmatched(),function(e){return a.log(e)},function(e){return a.error(e)})},e.deleteAccount=function(){u.show({destructiveText:g.DELETE,titleText:g.DELETE_ACCOUNT,cancelText:g.CANCEL,cancel:function(){},destructiveButtonClicked:function(e){return f(),!0}})},e.debug=function(){console.log("debug..."),u.show({destructiveText:"Send Debug Logs",titleText:"UID: "+r.getProfile().uid+" Env: "+d,cancelText:g.CANCEL,cancel:function(){},destructiveButtonClicked:function(e){return a.error("debug log"),!0}})},e.getProfilesNew=function(){console.log("getProfilesNew..."),i.blockingCall(r.getProfileNew(),function(e){console.log("Results found: "+e.length)})},n.fromTemplateUrl("introWalkthrough.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t}),e.openModal=function(){e.modal.show()},e.closeModal=function(){e.modal.hide()},e.debug=function(){console.log("debug..."),u.show({destructiveText:"Send Debug Logs",titleText:"UID: "+r.getProfile().uid+" Env: "+d,cancelText:g.CANCEL,cancel:function(){},destructiveButtonClicked:function(e){return a.error("debug log"),!0}})},e.filterInfoPopup=function(){var e=o.alert({title:"Advanced Filter Options",template:'<p class="center">To use this option you need to finalise your profile. This should take around 15 seconds.</p>'});e.then(function(){return t.go("menu.profile-edit")})}}]).controller("ContactCtrl",["$scope","AppService","AppUtil","$translate",function(e,t,n,o){var r;o(["GIVE_US_FEEDBACK"]).then(function(e){r=e}),e.contact={message:""},e.sendMessage=function(){return e.contact.message.length<10?void n.toastSimple("Write at least a few words!"):void n.blockingCall(t.sendContactMessage(e.contact.message),function(){e.contact.message="",n.toastSimple("Message sent")})}}]).controller("LocationCtrl",["$scope","$translate","AppService","AppUtil","$ionicLoading",function(e,t,n,o,r){var i;t(["GPS_ERROR"]).then(function(e){i=e});var a=n.getProfile(),s=a.location;e.location={useGPS:a.gps};var l=new google.maps.LatLng(s.latitude,s.longitude),c={center:l,zoom:11,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1,disableDoubleClickZoom:!0},u=new google.maps.Map(document.getElementById("map"),c);e.map=u,u.setCenter(l);var d=new google.maps.Marker({position:l,map:u,title:"My Location",draggable:!a.gps});google.maps.event.addListener(u,"click",function(t){e.location.useGPS||d.setPosition(t.latLng)}),e.useGPSchanged=function(){d.setDraggable(!e.location.useGPS),e.location.useGPS&&(r.show({templateUrl:"loading.html"}),n.getCurrentPosition().then(function(e){return n.saveProfile({gps:!0,location:e})}).then(function(e){var t=new google.maps.LatLng(e.location.latitude,e.location.longitude);d.setPosition(t),u.setCenter(t),r.hide()},function(t){r.hide(),"GPS_ERROR"===t?o.toastSimple(i.GPS_ERROR):o.toastSimple(i.SETTINGS_SAVE_ERROR),e.location.useGPS=!1,d.setDraggable(!0)}))},e.setLocation=function(){var e=d.getPosition();o.blockingCall(n.saveProfile({gps:!1,location:{latitude:e.lat(),longitude:e.lng()}}),function(){},"SETTINGS_SAVE_ERROR")}}]).controller("ShareVidHomeCtrl",["$rootScope","$cordovaCapture","$cordovaCamera","$scope","$state",function(e,t,n,o,r){o.recordVideo=function(){var n={limit:1,duration:20};t.captureVideo(n).then(function(t){e.currentVideoPath=t[0].fullPath,r.go("sharevidupload")},function(e){})}}]).controller("ShareVidUploadCtrl",["$scope","$window","$cordovaSocialSharing","$rootScope","$cordovaCapture","$cordovaCamera","$ionicPopup","$ionicLoading","$cordovaFileTransfer",function(e,t,n,o,r,i,a,s,l){function c(){var e=o.currentVideoPath;return ionic.Platform.isAndroid()?"file"!=e.substring(0,4)&&(e="file:/"+e):ionic.Platform.isIOS(),e}function u(e){s.show({content:"Processing please wait",animation:"fade-in",showBackdrop:!0,showDelay:0});var t={fileKey:"video",fileName:"will_be_provided_by_user.mp4",chunkedMode:!1,mimeType:"video/mp4"};l.upload("http://sandboxserver.co.za/upload_to_youtube.php",e,t,!0).then(function(e){console.log(e.response),s.hide();var t=JSON.parse(e.response);"undefined"!=typeof t.status&&null!=typeof t.status?a.alert({title:"Successfull",template:"Video Successfully uploaded. Thanks you for sharing!<br> Link:<b>"+t.video_url}).then(function(e){}):a.alert({title:"Error",template:"Upload failed please try again"}).then(function(e){})},function(e){console.log("ERROR: "+JSON.stringify(e)),a.alert({title:"Error",template:"Upload failed please try again"}).then(function(e){})},function(e){})}e.vid_height=t.innerHeight/2,e.vid_width=t.innerWidth,e.recordVideo=function(){var e={limit:1,duration:20};r.captureVideo(e).then(function(e){o.currentVideoPath=e[0].fullPath;var t=document.getElementById("video_to_upload");t.src=e[0].fullPath,t.play()},function(e){})},e.share=function(){var e=c();u(e)}}]),angular.module("controllers").controller("ChatsCtrl",["$scope","$log","AppService","$ionicPopover","$localStorage",function(e,t,n,o,r){function i(){t.debug("ChatsCtrl update()");var o=a(n.getMutualMatches()),r=o.length;o=_.uniq(o,"id"),o.length!==r&&t.error("Found duplicated in matches"),e.matches=o}function a(t){e.settings=r.chatSettings||{sortBy:"updated"};var n=t;return"updated"===e.settings.sortBy?t.sort(function(e,t){return e.updatedAt.getTime()===t.updatedAt.getTime()?0:"undefined"!=typeof e.lastMessageAt&&"undefined"!=typeof t.lastMessageAt?e.lastMessageAt.getTime()>t.lastMessageAt.getTime()?-1:1:"undefined"==typeof e.lastMessageAt&&"undefined"!=typeof t.lastMessageAt?e.updatedAt.getTime()>t.lastMessageAt.getTime()?-1:1:"undefined"!=typeof e.lastMessageAt&&"undefined"==typeof t.lastMessageAt?e.lastMessageAt.getTime()>t.updatedAt.getTime()?-1:1:e.updatedAt.getTime()>t.updatedAt.getTime()?-1:1}):"name"===e.settings.sortBy&&(_.forEach(n,function(e){return e.name=e.profile.name?e.profile.name.toLowerCase():"zzz"}),n=_.sortByOrder(t,["name"],[!0])),n}e.$on("$ionicView.beforeEnter",function(){i(),n.resetBadge()}),e.$on("chatsUpdated",function(){i()}),e.chatSettings=function(t){var n='<ion-popover-view style="height: 200px;"><ion-header-bar><h1 class="title">Chat Settings</h1></ion-header-bar><ion-content><chat-settings/></ion-content></ion-popover-view>';e.popover=o.fromTemplate(n,{scope:e}),e.popover.show(t),e.closePopover=function(){return e.popover.hide()},e.$on("$destroy",function(){return e.popover.remove()})}}]).directive("chatSettings",["$localStorage","$rootScope","$log",function(e,t,n){return{restrict:"E",scope:{},template:'<ion-list><div class="item item-divider">Sort by:</div><ion-radio ng-model="settings.sortBy" ng-click="sortByUpdated(\'updated\')" ng-value="\'updated\'">Recently updated</ion-radio><ion-radio ng-model="settings.sortBy" ng-click="sortByUpdated(\'name\')" ng-value="\'name\'">Name</ion-radio></ion-list>',controller:["$scope",function(o){o.settings=e.chatSettings||{sortBy:"updated"},o.sortByUpdated=function(r){n.debug("chatSettings.sortByUpdated "+o.settings.sortBy),e.chatSettings=o.settings,t.$broadcast("chatsUpdated")}}]}}]).controller("ChatCtrl",["$scope","$log","$timeout","$interval","$translate","$ionicScrollDelegate","$state","$stateParams","$ionicHistory","$ionicNavBarDelegate","$ionicActionSheet","$ionicPopup","$ionicLoading","AppService","AppUtil","$cordovaCamera","$cordovaFile","ImagesUtil","$cordovaClipboard",function(e,t,n,o,r,i,a,s,l,c,u,d,f,g,p,h,m,v,S){function y(){p.blockingCall(g.reportProfile("chat",e.matchProfile,e.match),function(){d.confirm({title:R.MATCH_REPORTED,template:R.WANT_TO_REMOVE_MATCH,okText:R.REMOVE,cancelText:R.CANCEL}).then(function(e){e&&E()})})}function E(){p.blockingCall(g.removeMatch(s.matchId),function(){l.nextViewOptions({historyRoot:!0,disableBack:!0}),a.go("menu.chats")},"REMOVE_MATCH_ERROR")}function P(o){if(!ionic.Platform.isWebView())return!0;var r={quality:70,destinationType:Camera.DestinationType.DATA_URL,sourceType:o,allowEdit:!1,encodingType:Camera.EncodingType.PNG,targetWidth:600,targetHeight:600,saveToPhotoAlbum:!1};h.getPicture(r).then(function(o){var r="data:image/png;base64,"+o,i={},a=Date.now();i.sentAt=a,i.imageBase64=r,e.sendingMessages.push(i),n(function(){F.scrollBottom(!0)},0),g.sendChatMessage(s.matchId,null,r).then(function(t){_.remove(e.sendingMessages,"sentAt",a),t.imageBase64=r},function(n){_.remove(e.sendingMessages,"sentAt",a),e.failedMessages.push(i),t.error("error sending message "+JSON.stringify(n)),p.toastSimple(R.MESSAGE_NOT_SENT)})},function(e){t.log("$cordovaCamera.getPicture error "+JSON.stringify(e))})}function b(){window.plugins.audioRecorderAPI.stop(function(e){t.log("audio cancel stop ok: "+JSON.stringify(e));var n=savedFilePath.split("/")[savedFilePath.split("/").length-1];t.log("fileName: "+n);var o;o=cordova.file.documentsDirectory?cordova.file.documentsDirectory:cordova.file.externalRootDirectory,m.removeFile(cordova.file.dataDirectory,n).then(function(e){t.log("deleted audio file")},function(e){t.log("error deleting cancelled audio file "+JSON.stringify(e))})},function(e){t.log("audio cancel stop err: "+JSON.stringify(e))})}function A(){window.plugins.audioRecorderAPI.stop(function(o){t.log("audio save stop ok: "+JSON.stringify(o));var r=o.split("/")[o.split("/").length-1];t.log("fileName: "+r);var i=cordova.file.documentsDirectory?cordova.file.documentsDirectory:cordova.file.externalRootDirectory;i=cordova.file.dataDirectory,m.readAsDataURL(i,r).then(function(o){t.log("readAsDataURL success "+JSON.stringify(o)),m.removeFile(i,r);var a={},l=Date.now();a.sentAt=l,a.audioBase64=o,e.sendingMessages.push(a),n(function(){F.scrollBottom(!0)},0),g.sendChatMessage(s.matchId,null,null,o).then(function(t){_.remove(e.sendingMessages,"sentAt",l),m.moveFile(i,r,i,t.id+".m4a")},function(n){_.remove(e.sendingMessages,"sentAt",l),e.failedMessages.push(a),t.error("error sending message "+JSON.stringify(n)),p.toastSimple(R.MESSAGE_NOT_SENT)})},function(e){t.log("readAsDataURL error "+JSON.stringify(e))})},function(e){t.log("audio save stop err: "+JSON.stringify(e))})}function T(n){_.remove(e.failedMessages,"sentAt",n.sentAt);var o=Date.now();n.sentAt=o,e.sendingMessages.push(n),g.sendChatMessage(s.matchId,n).then(function(t){_.remove(e.sendingMessages,"sentAt",o)},function(r){_.remove(e.sendingMessages,"sentAt",o),e.failedMessages.push(n),t.error("error resending message "+JSON.stringify(r)),p.toastSimple(R.MESSAGE_NOT_SENT)})}function C(){}function M(e){k=e.keyboardHeight}function w(e){k=0,n(function(){U.style.bottom=I.clientHeight+"px"},0)}var R;r(["UNMATCHED","REMOVE_MATCH","REPORT","MATCH_OPTIONS","CANCEL","REMOVE_MATCH_ERROR","MATCH_REPORTED","WANT_TO_REMOVE_MATCH","REMOVE","MESSAGE_NOT_SENT","REQUEST_FAILED"]).then(function(e){R=e}),e.messages=[],e.sendingMessages=[],e.failedMessages=[],e.profile=g.getProfile();var O,I,U,N,L,F=i.$getByHandle("userMessageScroll");window.addEventListener("native.keyboardshow",function(){document.body.classList.add("keyboard-open")}),e.$on("$ionicView.beforeEnter",function(){t.log("$stateParams.matchId "+s.matchId),e.match=g.getMatch(s.matchId),g.getProfileByMatchId(s.matchId).then(function(n){t.log("match profile "+JSON.stringify(n)),e.matchProfile=n}),L=g.getActiveChat(s.matchId).then(function(t){e.messages=t,e.matchId=s.matchId})}),e.$on("$ionicView.enter",function(){window.cordova&&(cordova.plugins.Keyboard.disableScroll(!0),window.addEventListener("native.keyboardshow",M),window.addEventListener("native.keyboardhide",w)),f.show({templateUrl:"loading.html",noBackdrop:!0,delay:400}),L.then(function(){e.doneLoading=!0,F.scrollBottom(),f.hide(),e.input={message:localStorage["userMessage-"+e.matchProfile.id]||""},n(function(){I=document.body.querySelector("#userMessagesView .bar-footer"),U=document.body.querySelector("#userMessagesView .scroll-content"),N=angular.element(I.querySelector("textarea"))},0),O=o(function(){},2e4)},function(n){e.messages=[],f.hide(),t.log("error loading chat "+JSON.stringify(n)),p.toastSimpleTranslate("REQUEST_FAILED")})}),e.$on("$ionicView.afterEnter",function(){g.setChatRead(s.matchId,!0),e.match=g.getMatch(s.matchId)}),e.$on("$ionicView.beforeLeave",function(){e.input.message&&0!=e.input.message.trim().length?localStorage["userMessage-"+e.matchProfile.id]=e.input.message:localStorage.removeItem("userMessage-"+e.matchProfile.id)}),e.$on("$ionicView.leave",function(){window.cordova&&(window.removeEventListener("native.keyboardshow",M),window.removeEventListener("native.keyboardhide",w),cordova.plugins.Keyboard.disableScroll(!1)),angular.isDefined(O)&&(o.cancel(O),O=void 0)}),e.$on("newMessage",function(e,t){t.match.id==s.matchId&&(i.scrollBottom(!0),n(function(){g.setChatRead(t.match.id,!0)},1e3))}),e.$on("chatsUpdated",function(e,n){t.log("on ChatCtrl chatsUpdated"),n===s.matchId&&(p.toastSimpleTranslate("UNMATCHED"),l.goBack())}),e.chatOptions=function(){u.show({buttons:[{text:R.REPORT}],destructiveText:R.REMOVE_MATCH,titleText:R.MATCH_OPTIONS,cancelText:R.CANCEL,cancel:function(){},destructiveButtonClicked:function(e){return E(),!0},buttonClicked:function(e){return y(),!0}})},e.showKeyboard=function(){return cordova.plugins.Keyboard.show()},e.sendMessage=function(o){if(e.input.message.trim().length){C();var r=e.input.message;e.input.message="";var i={},a=Date.now();i.sentAt=a,i.text=r,e.sendingMessages.push(i),n(function(){C(),F.scrollBottom(!0)},0),g.sendChatMessage(s.matchId,r).then(function(t){_.remove(e.sendingMessages,"sentAt",a)},function(n){_.remove(e.sendingMessages,"sentAt",a),e.failedMessages.push(i),t.error("error sending message "+JSON.stringify(n)),p.toastSimple(R.MESSAGE_NOT_SENT)})}},e.imageFromCamera=function(){return P(Camera.PictureSourceType.CAMERA)},e.imageFromLibrary=function(){return P(Camera.PictureSourceType.PHOTOLIBRARY)};var D;e.recordAudio=function(){D=d.confirm({title:"Recording...",template:"Speak now!"}),D.then(function(e){e?A():b()}),window.plugins.audioRecorderAPI.record(function(e){t.log("record ok: "+JSON.stringify(e))},function(e){D&&D.close(),t.log("record err: "+JSON.stringify(e))})},e.playAudio=function(e){t.log("playing audio from "+e),new Audio(e).play()},e.onMessageHold=function(e,n,o){t.log("onMessageHold index:"+n+" message.id:"+o.id),(o.text||o.image)&&u.show({buttons:[{text:r.instant(o.image?"SAVE_IMAGE":"COPY_TEXT")}],buttonClicked:function(e){switch(e){case 0:if(o.image){var n=v.convertImgIdToBase64(o.id+"_img");cordova.base64ToGallery?cordova.base64ToGallery(n,"img_",function(e){return t.log("Saved image to gallery "+e)},function(e){return t.error("Error saving chat image to gallery",e)}):p.toastSimple("Saving image not supported")}o.text&&(cordova.plugins.clipboard?S.copy(o.text).then(function(){return p.toastSimple("Message copied to clipboard")},function(){return p.toastSimple("Unable to copy to clipboard")}):p.toastSimple("Copy to clipboard not supported"))}return!0}})},e.onFailedMessageHold=function(n,o,i){t.log("onFailedMessageHold: "+JSON.stringify(i,null,2)),u.show({buttons:[{text:r.instant("RESEND")},{text:r.instant("EDIT")},{text:r.instant("DELETE")}],buttonClicked:function(t){switch(t){case 0:T(i);break;case 1:e.input.message=i.text,_.remove(e.failedMessages,"sentAt",i.sentAt);break;case 2:_.remove(e.failedMessages,"sentAt",i.sentAt)}return!0}})};var k=0;e.$on("elastic:resize",function(e,t){if(t){var n=t[0].offsetHeight;if(I){var o=n+10;o=o>44?o:44,I.style.height=o+"px",device&&"ios"===device.platform.toLowerCase()?U.style.bottom=o+k+"px":U.style.bottom=o+"px"}}})}]),angular.module("constants",[]).constant("appName","Just a Baby").constant("parseAppId","11111111122444").constant("parseMount","/parse/").constant("gcpBrowserKey","AIzaSyCUgT951OiYF4TmpR-lcpPd9zJ_NVBpoow").constant("playStoreUrl","http://goo.gl/6fQnJC").constant("itunesUrl","https://goo.gl/438VwP").constant("webStoreUrl","http://justababy.co").constant("facebookAppId","1219040608124053").constant("linkedInId","").constant("linkedInSecret","").constant("socialShareMessage","With Just-a-Baby, you know youâre meeting people who are ready to help you start your new journey.").constant("socialShareSubject","Download the App now.").constant("adMob",{android:{banner:"",interstitial:""},ios:{banner:"",interstitial:""}}).constant("serverUrl","https://justababy-prod.appspot.com").constant("env","prod");var FACEBOOK_APP_ID="1219040608124053";
//# sourceMappingURL=maps/app.js.map

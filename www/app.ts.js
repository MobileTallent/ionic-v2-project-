"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t,i,o,n,r,s,a,l){var c=this;_classCallCheck(this,e),t.info("LikedMe constructor"),this.$log=t,this.$rootScope=i,this.$scope=o,this.$state=n,this.$ionicModal=r,this.$ionicPopup=s,this.AppService=a,this.AppUtil=l,r.fromTemplateUrl("profileModal.html",{scope:o,animation:"slide-in-up"}).then(function(e){return c.profileModal=e}),o.$on("$destroy",function(){return c.profileModal.remove()}),this.refresh()}return e.$inject=["$log","$rootScope","$scope","$state","$ionicModal","$ionicPopup","AppService","AppUtil"],_createClass(e,[{key:"refresh",value:function(){var e=this;this.AppService.getProfilesWhoLikeMe().then(function(t){e.profiles=t,e.$log.log("getProfilesWhoLikeMe returned "+t.length+" profiles")},function(t){e.$log.error("Error loading profiles who liked me "+JSON.stringify(t)),e.AppUtil.toastSimple("Unable to load profiles")})["finally"](function(){return e.$scope.$broadcast("scroll.refreshComplete")})}},{key:"view",value:function(e){this.$log.debug("viewing profile who liked me at index "+e),this.profile=this.profiles[e],this.profileIndex=e,this.profileModal.show()}},{key:"like",value:function(){this.$log.debug("liking profile at index "+this.profileIndex),this.process(!0)}},{key:"pass",value:function(){this.$log.debug("passing profile at index "+this.profileIndex),this.process(!1)}},{key:"process",value:function(e){var t=this;this.AppUtil.blockingCall(this.AppService.processMatch(this.profile,e),function(){t.profiles.splice(t.profileIndex,1),t.close()})}},{key:"close",value:function(){this.profileModal.hide(),this.profileIndex=null,this.profile=null}},{key:"onClickBadgeInfo",value:function(){this.$ionicPopup.alert({title:"Self Identification Badges",templateUrl:"badgeInfo.html",buttons:[{text:"Ok",type:"button-assertive"}]})}}]),e}();e.LikedMe=t,t.$inject=["$log","$rootScope","$scope","$state","$ionicModal","$ionicPopup","AppService","AppUtil"],angular.module("controllers").controller("LikedMe",t)}(app||(app={}));var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t,i,o,n,r,s,a){var l=this;_classCallCheck(this,e),t.info("RelationshipCtrl constructor"),this.$log=t,this.$rootScope=i,this.$scope=o,this.$state=n,this.$ionicModal=r,this.AppService=s,this.AppUtil=a,r.fromTemplateUrl("profileModal.html",{scope:o,animation:"slide-in-up"}).then(function(e){return l.profileModal=e}),o.$on("$destroy",function(){return l.profileModal.remove()}),this.refresh()}return e.$inject=["$log","$rootScope","$scope","$state","$ionicModal","AppService","AppUtil"],_createClass(e,[{key:"refresh",value:function(){var e=this;this.AppService.getProfilesWhoWantsToHaveARelationshipWithMe().then(function(t){e.profilePendingRequest=t.pendingUserRequest,e.profilePendingInvite=t.pendingUserInvite,e.profileMutual=t.mutualUsers,e.$log.log("getProfilesWhoWantsToHaveARelationshipWithMe pending request returned "+e.profilePendingRequest.length+" profiles"),e.$log.log("getProfilesWhoWantsToHaveARelationshipWithMe pending invitereturned "+e.profilePendingInvite.length+" profiles"),e.$log.log("getProfilesWhoWantsToHaveARelationshipWithMe mutual returned "+e.profileMutual.length+" profiles")},function(t){e.$log.error("Error loading profiles who wants to have a relationship with current user "+JSON.stringify(t)),e.AppUtil.toastSimple("Unable to load profiles")})["finally"](function(){return e.$scope.$broadcast("scroll.refreshComplete")})}},{key:"view",value:function(e,t){this.$log.debug("viewing profile who wants to have a relationship with me at index "+e),this.profiles=t,this.profile=this.profiles[e],this.profileIndex=e,this.profileModal.show()}},{key:"like",value:function(){this.$log.debug("approving relationship invite at index "+this.profileIndex),this.process(!0)}},{key:"pass",value:function(){this.$log.debug("declining relationship invite at index "+this.profileIndex),this.process(!1)}},{key:"process",value:function(e){var t=this;this.AppUtil.blockingCall(this.AppService.processPregnancy(this.profile,e),function(){t.profiles.splice(t.profileIndex,1),t.close()})}},{key:"close",value:function(){this.profileModal.hide(),this.profileIndex=null,this.profile=null}}]),e}();e.RelationshipCtrl=t,t.$inject=["$log","$rootScope","$scope","$state","$ionicModal","AppService","AppUtil"],angular.module("controllers").controller("RelationshipCtrl",t)}(app||(app={}));var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t,i,o,n,r,s,a){_classCallCheck(this,e),this.$log=t,this.$cordovaSocialSharing=i,this.socialShareMessage=o,this.socialShareSubject=n,this.playStoreUrl=r,this.itunesUrl=s,this.webStoreUrl=a}return e.$inject=["$log","$cordovaSocialSharing","socialShareMessage","socialShareSubject","playStoreUrl","itunesUrl","webStoreUrl"],_createClass(e,[{key:"share",value:function(){var e=this;this.shareStoreUrl=ionic.Platform.isAndroid()?this.playStoreUrl:ionic.Platform.isIOS()?this.itunesUrl:this.webStoreUrl,this.$cordovaSocialSharing.share(this.socialShareSubject,this.socialShareMessage,null,this.shareStoreUrl).then(function(){"undefined"!=typeof analytics&&analytics.trackView("Invite My Friends Controller"),e.$log.debug("Social share action complete")},function(t){e.$log.error("Social share action error "+JSON.stringify(t))})}}]),e}();e.ShareController=t,t.$inject=["$log","$cordovaSocialSharing","socialShareMessage","socialShareSubject","playStoreUrl","itunesUrl","webStoreUrl"],angular.module("controllers.share",["constants","ngCordova.plugins.socialSharing","ionic"]).controller("ShareController",t)}(app||(app={}));var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t,i,o,n,r,s,a,l){var c=this;_classCallCheck(this,e),this.$log=t,this.$rootScope=i,this.$scope=o,this.$ionicModal=n,this.$ionicPopup=r,this.AppService=s,this.AppUtil=a,this.ParseService=l,this.hasWebRTC=navigator.webkitGetUserMedia||navigator.mozGetUserMedia,this.Inviting="inviting",this.InCall="inCall",this.Incoming="incoming",o.video=this,this.$ionicModal.fromTemplateUrl("video.html",{scope:this.$scope,animation:"slide-in-up"}).then(function(e){return c.modal=e}),s.twilioAccessToken?this.init(s.twilioAccessToken):i.$on("twilioAccessToken",function(e,t){return c.init(t)})}return e.$inject=["$log","$rootScope","$scope","$ionicModal","$ionicPopup","AppService","AppUtil","ParseService"],_createClass(e,[{key:"isSupported",value:function(){return this.hasWebRTC&&this.conversationsClient&&this.conversationsClient.isListening}},{key:"init",value:function(e){var t=this;if(this.$log.log("Initialising Twilio"),!this.hasWebRTC)return void this.$log.log("WebRTC not supported");var i=new Twilio.AccessManager(e);i.on("tokenExpired",function(){t.$log.warn("Twilio token expired"),t.ParseService.getTwilioToken().then(function(e){i.updateToken(e)},function(e){return t.$log.error("Error getting an updated Twilio token",e)})}),i.on("error",function(e){t.closeModal(),t.AppUtil.toastSimpleTranslate("VIDEO_SERVICE_ERROR"),t.$log.error("Twilio access manager error",e)}),this.conversationsClient=new Twilio.Conversations.Client(i),this.conversationsClient.listen().then(function(){return t.onClientConnected()},function(e){t.$log.error("Twilio Conversations.Client.listen() error",e),t.AppUtil.toastSimpleTranslate("VIDEO_SERVICE_ERROR")}),this.conversationsClient.on("error",function(e){t.closeModal(),t.AppUtil.toastSimpleTranslate("VIDEO_SERVICE_ERROR"),t.$log.error("Twilio conversation client error",e)})}},{key:"openModal",value:function(e){this.state=e,this.modal.show()}},{key:"closeModal",value:function(){if(this.modal.hide(),this.activeConversation){try{this.activeConversation.localMedia.stop(),this.activeConversation.disconnect()}catch(e){}this.activeConversation=null}this.profile=null,this.state=null,this.incomingInvite=null}},{key:"invite",value:function(e){var t=this;this.$log.log("Inviting user id:"+e),this.profile=this.AppService.getProfileByUserId(e),this.openModal(this.Inviting),this.conversationsClient.inviteToConversation(e).then(function(e){return t.conversationStarted(e)},function(e){t.closeModal(),t.AppUtil.toastSimpleTranslate("VIDEO_START_ERROR"),t.$log.error("Twilio conversationStarted error "+e+" "+JSON.stringify(e))})}},{key:"accept",value:function(){var e=this;this.incomingInvite&&"pending"===this.incomingInvite.status?this.incomingInvite.accept().then(function(t){return e.conversationStarted(t)},function(t){e.closeModal(),e.AppUtil.toastSimpleTranslate("VIDEO_START_ERROR"),e.$log.error("Twilio incomingInvite.accept() error",t)}):(this.closeModal(),this.AppUtil.toastSimpleTranslate("VIDEO_START_ERROR"),this.$log.info("Did not accept incomingInvite "+(this.incomingInvite?this.incomingInvite.status:"null")))}},{key:"reject",value:function(){if(this.incomingInvite)try{this.incomingInvite.reject()}catch(e){this.$log.warn("Error rejecting video invite",e)}this.closeModal()}},{key:"cancelInvite",value:function(){this.closeModal()}},{key:"disconnect",value:function(){this.closeModal(),this.activeConversation&&this.activeConversation.disconnect()}},{key:"onClientConnected",value:function(){var e=this;this.$log.log("Connected to Twilio. Listening for incoming Invites as "+this.conversationsClient.identity),this.conversationsClient.on("invite",function(t){e.$log.log("Incoming video invite from: "+t.from),e.profile=e.AppService.getProfileByUserId(t.from),e.activeConversation?(e.AppUtil.toastSimpleTranslate("Conversation already active. Rejecting invite"),t.reject()):(e.incomingInvite=t,e.openModal(e.Incoming))})}},{key:"conversationStarted",value:function(e){var t=this;this.$log.log("In an active Conversation"),this.activeConversation=e,this.state=this.InCall,this.$scope.$apply(),e.localMedia.attach("#video-local"),this.$log.log("Attached local media"),e.on("participantConnected",function(e){t.$log.log("Participant "+e.identity+" connected"),e.media.attach("#video-remote"),t.$log.log("Attached remote video")}),e.on("participantDisconnected",function(e){t.$log.log("Participant "+e.identity+" disconnected"),e.media.detach("#video-remote"),t.closeModal()}),e.on("ended",function(e){t.$log.log("Twilio conversation ended"),e.localMedia.stop(),e.disconnect(),t.activeConversation=null,t.closeModal()})}}]),e}();e.TwilioVideoChat=t,t.$inject=["$log","$rootScope","$scope","$ionicModal","$ionicPopup","AppService","AppUtil","ParseService"];var i=angular.module("controllers");i.controller("TwilioVideoChat",t)}(app||(app={}));var mock$state=function(e){var t={};return t.go=function(){},e.value("$state",t),t},mock$ionicHistory=function(e){var t={};return e.value("$ionicHistory",t),t},mock$localStorage=function(e){var t={};return e.value("$localStorage",t),t},mock$analytics=function(e){var t={eventTrack:function(){}};return e.value("$analytics",t),t},mock$translate=function(e){var t={instant:function(e){return e}};return e.value("$translate",t),t},mockAppService=function(e){var t={};return e.value("AppService",t),t},mockParseService=function(e){var t,i={};return i.inject=function(e){return t=e},i.init=function(){return t.when()},i.getUserId=function(){return"uid"},i.sendChatMessage=function(e,i){return e.id=" ",e.match=i,t.when(e)},i.rebuildMatches=function(){return t.when()},e.value("ParseService",i),i},mockLocalDB=function(e){var t,i={};return i.inject=function(e){return t=e},i.init=function(){return t.when()},i.getUnreadChats=function(){return t.when({})},i.setChatRead=function(e,i){return t.when()},i.saveChatMessage=function(){return t.when(!0)},e.value("LocalDB",i),i},mockAppUtil=function(e){var t={};return t.blockingCall=function(e,t,i){return t(e)},t.toastSimpleTranslate=function(e){},t.toastSimple=function(e){},e.value("AppUtil",t),t},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t,i,o,n,r){var s=this;_classCallCheck(this,e),this.$ionicPopup=t,this.$log=i,this.$scope=o,this.AppService=n,this.AppUtil=r,o.$on("$ionicView.beforeEnter",function(){return s.refreshAbout()})}return e.$inject=["$ionicPopup","$log","$scope","AppService","AppUtil"],_createClass(e,[{key:"refreshAbout",value:function(){var e=this;this.AppUtil.blockingCall(this.AppService.getAboutJab(),function(t){e.about=t})}},{key:"saveAbout",value:function(){var e=this;this.AppUtil.blockingCall(this.AppService.addAboutJab(this.about),function(){e.AppUtil.toastSimple("Saved Successfully"),e.refreshAbout()})}}]),e}();e.AboutJAB=t,t.$inject=["$ionicPopup","$log","$scope","AppService","AppUtil"],angular.module("controllers").controller("AboutJAB",t)}(app||(app={}));var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t,i,o,n,r,s,a,l){var c=this;_classCallCheck(this,e),this.$log=t,this.$rootScope=i,this.$scope=o,this.$q=n,this.$state=r,this.$ionicModal=s,this.AppService=a,this.AppUtil=l,this.$scope.options={pagination:!1,onlyExternal:!0},s.fromTemplateUrl("applybadges.html",{scope:o,animation:"slide-in-up"}).then(function(e){return c.profileModal=e}),o.$on("$destroy",function(){return c.profileModal.remove()}),this.$scope.$on("$ionicSlides.sliderInitialized",function(e,t){o.slider=t.slider}),this.refresh()}return e.$inject=["$log","$rootScope","$scope","$q","$state","$ionicModal","AppService","AppUtil"],_createClass(e,[{key:"refresh",value:function(){var e=this;this.AppUtil.blockingCall(this.AppService.getApplyBadgeUsers(),function(t){e.$log.log("Loaded "+t.length+" items"),e.profiles=t})}},{key:"viewDetails",value:function(e){this.profile=e,this.personCategory=this.profile.personCategory,this.personType=this.profile.personType,this.personSperm=this.profile.personSperm,this.personEgg=this.profile.personEgg,this.personWomb=this.profile.personWomb,this.personEmbryo=this.profile.personEmbryo,this.personHelpLevel=this.profile.personHelpLevel,this.profileModal.show()}},{key:"closeModal",value:function(){this.refresh(),this.profile=null,this.profileModal.hide()}},{key:"applyBadge",value:function(){var e=this,t={};t.personCategory=this.personCategory?this.personCategory:"0",t.hasSelfId=!0,"3"===this.personCategory?(t.personType="0",t.personSperm=!1,t.personEgg=!1,t.personWomb=!1,t.personEmbryo=!1,t.personHelpLevel="0"):(t.personType=this.personType?this.personType:"0",t.personSperm=!!this.personSperm&&this.personSperm,t.personEgg=!!this.personEgg&&this.personEgg,t.personWomb=!!this.personWomb&&this.personWomb,t.personEmbryo=!!this.personEmbryo&&this.personEmbryo,t.personHelpLevel=this.personHelpLevel?this.personHelpLevel:"0");var i="";t.personSperm&&(i+="S"),t.personEgg&&(i+="E"),t.personWomb&&(i+="W"),t.personEmbryo&&(i+="Y"),"3"===this.personCategory||t.personSperm||t.personEgg||t.personWomb||t.personEmbryo||(i+="X"),t.thingsIHave=i,this.AppUtil.blockingCall(this.AppService.saveProfileForApplyBadge(this.profile,t),function(){e.closeModal(),e.AppUtil.toastSimple("Badge Applied Successfully")})}}]),e}();e.ApplyBadges=t,t.$inject=["$log","$rootScope","$scope","$q","$state","$ionicModal","AppService","AppUtil"],angular.module("controllers").controller("ApplyBadges",t)}(app||(app={}));var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t,i,o,n,r,s,a,l,c,p){var u=this;_classCallCheck(this,e),this.$log=t,this.$rootScope=i,this.$scope=o,this.$q=n,this.$state=r,this.$ionicModal=s,this.$ionicActionSheet=a,this.AppService=l,this.AppUtil=c,this.$translate=p,s.fromTemplateUrl("admin/reportDetails.html",{scope:o,animation:"slide-in-up"}).then(function(e){return u.reportModal=e}),o.$on("$destroy",function(){return u.reportModal.remove()}),this.refresh()}return e.$inject=["$log","$rootScope","$scope","$q","$state","$ionicModal","$ionicActionSheet","AppService","AppUtil","$translate"],_createClass(e,[{key:"refresh",value:function(){var e=this;this.AppUtil.blockingCall(this.AppService.getBannedUsers(),function(t){return e.reports=t})}},{key:"viewDetails",value:function(e){var t=this;this.AppUtil.blockingCall(this.AppService.getReportedUserDetails(e),function(i){t.report=e,t.reportDetails=i,t.reportDetails.recentMessagesToReporter=_.filter(i.recentMessages,function(t){return t.userIds.indexOf(e.reportedBy.id)>-1}),t.reportDetails.recentMessagesToReporter.length>6&&t.reportDetails.recentMessagesToReporter.slice(0,5),t.reportModal.show()})}},{key:"fileUrl",value:function(e){return e.url?e.url():e._url}},{key:"deletePhoto",value:function(e){var t=this;this.$log.log("deleting photo at "+e),this.AppUtil.blockingCall(this.AppService.deletePhoto(this.report.id,e),function(){return _.remove(t.report.profile.photos,function(i){return t.fileUrl(i)===e})})}},{key:"actionReport",value:function(){var e=this;this.$ionicActionSheet.show({buttons:[{text:"Deleted Photo"},{text:"None"}],destructiveText:"Ban User",titleText:"Select Report Action",cancelText:this.$translate.instant("CANCEL"),buttonClicked:function(t){switch(t){case 0:e.closeReport("deleted photo");break;case 1:e.closeReport("none")}return!0},destructiveButtonClicked:function(t){return e.banUserAction(),!0}})}},{key:"closeReport",value:function(e){var t=this;this.$log.log("Closing report "+this.report.id+" with action "+e),this.AppUtil.blockingCall(this.AppService.closeReport(this.report.id,e),function(){t.closeModal(),_.remove(t.reports,"id",t.report.id),t.report=null,t.reportDetails=null})}},{key:"banUserAction",value:function(){var e=this;this.AppUtil.blockingCall(this.AppService.banUser(this.report.reportedUser),function(){e.closeModal(),e.report=null,e.reportDetails=null,e.refresh()})}},{key:"closeModal",value:function(){this.reportModal.hide()}}]),e}();e.BannedUsers=t,t.$inject=["$log","$rootScope","$scope","$q","$state","$ionicModal","$ionicActionSheet","AppService","AppUtil","$translate"],angular.module("controllers").controller("BannedUsers",t)}(app||(app={}));var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t,i,o,n,r,s,a){var l=this;_classCallCheck(this,e),this.$ionicPopup=t,this.$log=i,this.$scope=o,this.$state=n,this.$ionicModal=r,this.AppService=s,this.AppUtil=a,this.modalText="New ",this.submitted=!1,o.$on("$ionicView.beforeEnter",function(){return l.refresh()}),o.$on("$destroy",function(){return l.clinicsModal.remove()}),r.fromTemplateUrl("templates/modal.html",{scope:o,animation:"slide-in-up"}).then(function(e){return l.clinicsModal=e})}return e.$inject=["$ionicPopup","$log","$scope","$state","$ionicModal","AppService","AppUtil"],_createClass(e,[{key:"refresh",value:function(){var e=this;this.AppUtil.blockingCall(this.AppService.getClinicsQuestion(),function(t){e.$log.log("loaded "+t.length+" questions"),e.clinicQuestions=t})}},{key:"addClinicsQuestion",value:function(e){var t=this;this.submitted=!0,e.$valid&&(this.AppUtil.blockingCall(this.AppService.addClinicsQuestion(this.clinicQuestion),function(){t.modalText="New ",t.clinicQuestion=null,t.AppUtil.toastSimple("Saved Successfully"),t.refresh()}),setTimeout(this.resetForm(e),1e3))}},{key:"editClinicsQuestion",value:function(e){this.modalText="Update ",this.clinicQuestion=e.toJSON(),this.clinicsModal.show()}},{key:"deleteClinicsQuestion",value:function(e){this.$log.log("Delete question "+e);var t=this;this.$ionicPopup.confirm({title:"Delete Question",template:"Are you sure you want to delete this question?"}).then(function(i){i&&t.deleteQ(e)})}},{key:"deleteQ",value:function(e){var t=this;this.AppUtil.blockingCall(this.AppService.delClinicsQuestion(e),function(){t.AppUtil.toastSimple("Deleted Successfully"),t.refresh()})}},{key:"close",value:function(){this.modalText="New ",this.clinicQuestion=null,this.clinicsModal.hide()}},{key:"resetForm",value:function(e){this.clinicQuestion=null,this.clinicsModal.hide(),e.$setPristine(),e.$setUntouched()}}]),e}();e.ClinicsQuestion=t,t.$inject=["$ionicPopup","$log","$scope","$state","$ionicModal","AppService","AppUtil"],angular.module("controllers").controller("ClinicsQuestion",t)}(app||(app={}));var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t,i,o,n,r,s,a){var l=this;_classCallCheck(this,e),this.$ionicPopup=t,this.$log=i,this.$scope=o,this.$state=n,this.$ionicModal=r,this.AppService=s,this.AppUtil=a,this.email="",o.$on("$ionicView.enter",function(){l.$log.debug("AdminEmailSearch $ionicView.enter"),l.search()})}return e.$inject=["$ionicPopup","$log","$scope","$state","$ionicModal","AppService","AppUtil"],_createClass(e,[{key:"search",value:function(){var e=this;this.$scope.search={email:this.email},this.$ionicPopup.show({template:'<input type="text" ng-model="search.email">',title:"Enter email to search",subTitle:"Minimum 4 characters. Searches starting with",scope:this.$scope,buttons:[{text:"<b>Search</b>",type:"button-positive",onTap:function(t){return e.$scope.search.email.length<4?(e.AppUtil.toastSimple("Enter at least 4 characters"),void t.preventDefault()):e.$scope.search.email}}]}).then(function(t){e.$log.log("email search ",t),e.email=t,e.AppUtil.blockingCall(e.AppService.searchUsersByEmail(t),function(i){e.users=i,e.$log.info("Found "+i.length+" users with email starting with "+t)})})}}]),e}();e.AdminEmailSearch=t,t.$inject=["$ionicPopup","$log","$scope","$state","$ionicModal","AppService","AppUtil"],angular.module("controllers").controller("AdminEmailSearch",t)}(app||(app={}));var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t,i,o,n){var r=this;_classCallCheck(this,e),this.$log=t,this.$scope=i,this.AppService=o,this.AppUtil=n,this.labels=[],this.voterReport=null,this.series=["Matches Per Day","Series B"],this.numDays=7,this.matchData=[],this.chatsData=[28,48,40,19,86,27,90],this.data=[[]],this.datasetOverride=[{yAxisID:"y-axis-1"},{yAxisID:"y-axis-2"}],this.options={scales:{yAxes:[{id:"y-axis-1",type:"linear",display:!0,position:"left"},{id:"y-axis-2",type:"linear",display:!0,position:"right"}]}},i.$on("$ionicView.beforeEnter",function(){return r.getReport()})}return e.$inject=["$log","$scope","AppService","AppUtil"],_createClass(e,[{key:"getReport",value:function(){var e=this,t=new Date,i=new Date;for(i.setDate(i.getDate()-this.numDays+1),this.labels=[],this.matchData=[],this.voterReport=null,this.data=[[]];i<=t;)this.labels.push(i.toDateString()),i.setDate(i.getDate()+1);this.AppUtil.blockingCall(this.AppService.getMatchesReport(this.numDays),function(t){e.voterReport={},e.$log.log("LOADED "+t.length+" items"),t.forEach(function(t){t.matchedDate.toDateString()in e.voterReport?e.voterReport[t.matchedDate.toDateString()]++:e.voterReport[t.matchedDate.toDateString()]=1}),e.labels.forEach(function(t){t in e.voterReport?e.matchData.push(e.voterReport[t]):e.matchData.push(0)}),e.data[0]=e.matchData,e.AppService.getChatMessageReport(e.numDays).then(function(t){e.$log.log("loaded "+t.length+" chats");var i=_.groupBy(t,function(e){return e.createdAt.toDateString()});for(var o in i){var n=_.groupBy(o,function(e){return e.senderName});console.log("Names length: "+n.length)}})})}}]),e}();e.GraphReport=t,t.$inject=["$log","$scope","AppService","AppUtil"],angular.module("controllers").controller("GraphReport",t)}(app||(app={}));var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t,i,o,n,r,s,a){var l=this;_classCallCheck(this,e),this.$ionicPopup=t,this.$log=i,this.$scope=o,this.$state=n,this.$ionicModal=r,this.AppService=s,this.AppUtil=a,this.name="",o.$on("$ionicView.enter",function(){l.search()})}return e.$inject=["$ionicPopup","$log","$scope","$state","$ionicModal","AppService","AppUtil"],_createClass(e,[{key:"search",value:function(){var e=this;this.$scope.search={name:this.name},this.$ionicPopup.show({template:'<input type="text" ng-model="search.name">',title:"Enter name to search",subTitle:"Minimum 4 characters. Searches starting with",scope:this.$scope,buttons:[{text:"<b>Search</b>",type:"button-positive",onTap:function(t){return e.$scope.search.name.length<2?(e.AppUtil.toastSimple("Enter at least 2 characters"),void t.preventDefault()):e.$scope.search.name}}]}).then(function(t){e.$log.log("name search ",t),e.name=t,e.AppUtil.blockingCall(e.AppService.searchUsersByName(t),function(i){e.profiles=i,e.$log.info("Found "+i.length+" profiles with name starting with "+t)})})}}]),e}();e.AdminNameSearch=t,t.$inject=["$ionicPopup","$log","$scope","$state","$ionicModal","AppService","AppUtil"],angular.module("controllers").controller("AdminNameSearch",t)}(app||(app={}));var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t,i,o,n,r,s,a,l){var c=this;_classCallCheck(this,e),this.$ionicPopup=t,this.$log=i,this.$scope=o,this.$ionicHistory=n,this.$state=r,this.$stateParams=s,this.AppService=a,this.AppUtil=l,this.profilePhotos=[],o.$on("$ionicView.beforeEnter",function(){return c.refresh()})}return e.$inject=["$ionicPopup","$log","$scope","$ionicHistory","$state","$stateParams","AppService","AppUtil"],_createClass(e,[{key:"refresh",value:function(){var e=this;this.AppUtil.blockingCall(this.AppService.getProfilesWithPhotosToReview(),function(t){e.$log.log("loaded "+t.length+" profiles with photos to review"),t.forEach(function(t){return t.photosInReview.forEach(function(i){return e.profilePhotos.push({profile:t,file:i})})})})}},{key:"reviewPhoto",value:function(e,t,i){var o=this;console.log("controller reviewPhoto ",e,t,i),this.AppUtil.blockingCall(this.AppService.reviewPhoto(e.id,t.url(),i),function(){o.$log.log("photo review success"),o.profilePhotos.splice(_.findIndex(o.profilePhotos,function(e){return e.file.url()===t.url()}),1)})}}]),e}();e.PhotoReview=t,t.$inject=["$ionicPopup","$log","$scope","$ionicHistory","$state","$stateParams","AppService","AppUtil"],angular.module("controllers").controller("PhotoReview",t)}(app||(app={}));var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t,i,o,n,r,s,a,l,c,p){var u=this;_classCallCheck(this,e),this.$log=t,this.$rootScope=i,this.$scope=o,this.$q=n,this.$state=r,this.$ionicModal=s,this.$ionicActionSheet=a,this.AppService=l,this.AppUtil=c,this.$translate=p,s.fromTemplateUrl("admin/reportDetails.html",{scope:o,animation:"slide-in-up"}).then(function(e){return u.reportModal=e}),o.$on("$destroy",function(){return u.reportModal.remove()}),this.refresh()}return e.$inject=["$log","$rootScope","$scope","$q","$state","$ionicModal","$ionicActionSheet","AppService","AppUtil","$translate"],_createClass(e,[{key:"refresh",value:function(){var e=this;this.AppUtil.blockingCall(this.AppService.getReportedUsers(),function(t){return e.reports=t})}},{key:"viewDetails",value:function(e){var t=this;this.AppUtil.blockingCall(this.AppService.getReportedUserDetails(e),function(i){t.report=e,t.reportDetails=i,t.reportDetails.recentMessagesToReporter=_.filter(i.recentMessages,function(t){
return t.userIds.indexOf(e.reportedBy.id)>-1}),t.reportDetails.recentMessagesToReporter.length>6&&t.reportDetails.recentMessagesToReporter.slice(0,5),t.reportModal.show()})}},{key:"fileUrl",value:function(e){return e.url?e.url():e._url}},{key:"deletePhoto",value:function(e){var t=this;this.$log.log("deleting photo at "+e),this.AppUtil.blockingCall(this.AppService.deletePhoto(this.report.id,e),function(){return _.remove(t.report.profile.photos,function(i){return t.fileUrl(i)===e})})}},{key:"actionReport",value:function(){var e=this;this.$ionicActionSheet.show({buttons:[{text:"Deleted Photo"},{text:"None"}],destructiveText:"Ban User",titleText:"Select Report Action",cancelText:this.$translate.instant("CANCEL"),buttonClicked:function(t){switch(t){case 0:e.closeReport("deleted photo");break;case 1:e.closeReport("none")}return!0},destructiveButtonClicked:function(t){return e.banUserAction(),!0}})}},{key:"closeReport",value:function(e){var t=this;this.$log.log("Closing report "+this.report.id+" with action "+e),this.AppUtil.blockingCall(this.AppService.closeReport(this.report.id,e),function(){t.closeModal(),_.remove(t.reports,"id",t.report.id),t.report=null,t.reportDetails=null})}},{key:"banUserAction",value:function(){var e=this;this.AppUtil.blockingCall(this.AppService.banUser(this.report.reportedUser),function(){e.closeModal(),e.report=null,e.reportDetails=null,e.refresh()})}},{key:"closeModal",value:function(){this.reportModal.hide()}}]),e}();e.ReportedUsers=t,t.$inject=["$log","$rootScope","$scope","$q","$state","$ionicModal","$ionicActionSheet","AppService","AppUtil","$translate"],angular.module("controllers").controller("ReportedUsers",t)}(app||(app={}));var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t,i,o,n,r,s,a,l){var c=this;_classCallCheck(this,e),this.$ionicPopup=t,this.$log=i,this.$scope=o,this.$ionicHistory=n,this.$state=r,this.$stateParams=s,this.AppService=a,this.AppUtil=l,o.$on("$ionicView.beforeEnter",function(){var e=c.$stateParams.userId;c.$log.log("UserAdmin "+e),c.AppUtil.blockingCall(c.AppService.loadUser(e),function(t){c.user=t,c.$log.log("loaded user "+JSON.stringify(t));var i=c.AppService.getMutualMatches(),o=_.find(i,function(t){return t.uid1===e||t.uid2===e});c.isMatch=!!o})})}return e.$inject=["$ionicPopup","$log","$scope","$ionicHistory","$state","$stateParams","AppService","AppUtil"],_createClass(e,[{key:"deleteUser",value:function(){var e=this;this.$ionicPopup.confirm({title:"Confirm delete",okText:"Delete",cancelText:"Cancel"}).then(function(t){t&&e.AppUtil.blockingCall(e.AppService.deleteUser(e.user.id),function(){e.AppUtil.toastSimple("User deleted"),e.$log.info("Deleted user "+e.user.id),e.$ionicHistory.goBack()})})}},{key:"banUser",value:function(){var e=this;this.$ionicPopup.confirm({title:"Confirm ban",okText:"Ban",cancelText:"Cancel"}).then(function(t){t&&e.AppUtil.blockingCall(e.AppService.reportProfile("admin reporting reasons",e.user.profile,null),function(){e.AppService.banUser(e.user.id).then(function(){e.AppUtil.toastSimple("User banned"),e.$log.info("Banned user "+e.user.id),e.$ionicHistory.goBack()})})})}},{key:"connectUser",value:function(){var e=this;this.$ionicPopup.confirm({title:"Connect to user",okText:"Connect",cancelText:"Cancel"}).then(function(t){t&&e.AppUtil.blockingCall(e.AppService.processMatchFromAdmin(e.user.profile,!0,!0),function(){e.AppUtil.toastSimple("User connected"),e.$log.info("Established connection on user"+e.user.id),e.$ionicHistory.goBack()})})}}]),e}();e.UserAdmin=t,t.$inject=["$ionicPopup","$log","$scope","$ionicHistory","$state","$stateParams","AppService","AppUtil"],angular.module("controllers").controller("UserAdmin",t)}(app||(app={}));var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t,i,o,n){var r=this;_classCallCheck(this,e),this.$log=t,this.$scope=i,this.AppService=o,this.AppUtil=n,this.voteReports=null,this.voterReport=null,i.$on("$ionicView.beforeEnter",function(){return r.refresh()})}return e.$inject=["$log","$scope","AppService","AppUtil"],_createClass(e,[{key:"refresh",value:function(){var e=this;this.voteReports=null,this.voterReport=null,this.AppUtil.blockingCall(this.AppService.getFindUsReport(),function(t){e.voterReport={},e.$log.log("loaded "+t.length+" items"),e.voteReports=t,e.voteReports.forEach(function(t){t.name in e.voterReport?e.voterReport[t.name]++:e.voterReport[t.name]=1})})}}]),e}();e.VoteReport=t,t.$inject=["$log","$scope","AppService","AppUtil"],angular.module("controllers").controller("VoteReport",t)}(app||(app={}));var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t,i,o,n,r,s,a){var l=this;_classCallCheck(this,e),this.$ionicPopup=t,this.$log=i,this.$scope=o,this.$state=n,this.$ionicModal=r,this.AppService=s,this.AppUtil=a,this.modalText="New ",this.submitted=!1,o.$on("$ionicView.beforeEnter",function(){return l.refresh()}),o.$on("$destroy",function(){return l.findUsModal.remove()}),r.fromTemplateUrl("templates/modal.html",{scope:o,animation:"slide-in-up"}).then(function(e){return l.findUsModal=e})}return e.$inject=["$ionicPopup","$log","$scope","$state","$ionicModal","AppService","AppUtil"],_createClass(e,[{key:"refresh",value:function(){var e=this;this.AppUtil.blockingCall(this.AppService.getFindUs(),function(t){e.$log.log("loaded "+t.length+" items"),e.findUsGroup=t})}},{key:"addFindUs",value:function(e){var t=this;this.submitted=!0,e.$valid&&(this.AppUtil.blockingCall(this.AppService.addFindUs(this.findUs),function(){t.modalText="New ",t.findUs=null,t.AppUtil.toastSimple("Saved Successfully"),t.refresh()}),setTimeout(this.resetForm(e),1e3))}},{key:"editFindUs",value:function(e){this.modalText="Update ",this.findUs=e.toJSON(),this.findUsModal.show()}},{key:"deleteFindUs",value:function(e){this.$log.log("Delete find us name "+e);var t=this;this.$ionicPopup.confirm({title:"Delete",template:"Are you sure you want to delete this item?"}).then(function(i){i&&t.deleteQ(e)})}},{key:"deleteQ",value:function(e){var t=this;this.AppUtil.blockingCall(this.AppService.delFindUs(e),function(){t.AppUtil.toastSimple("Deleted Successfully"),t.refresh()})}},{key:"close",value:function(){this.modalText="New ",this.findUs=null,this.findUsModal.hide()}},{key:"resetForm",value:function(e){this.findUs=null,this.findUsModal.hide(),e.$setPristine(),e.$setUntouched()}}]),e}();e.WhereUFindUsAdmin=t,t.$inject=["$ionicPopup","$log","$scope","$state","$ionicModal","AppService","AppUtil"],angular.module("controllers").controller("WhereUFindUsAdmin",t)}(app||(app={})),angular.module("ionicApp").directive("chatProfileImage",["AppService",function(e){return{restrict:"E",scope:{chat:"="},template:'<img ng-src="{{::photoUrl}}" img-cache>',replace:!0,controller:["$scope",function(e){e.chat}]}}]),angular.module("ionicApp").directive("unreadChatsBadge",["AppService",function(e){return{restrict:"E",scope:{},template:'<span ng-show="unreadChats > 0" class="badge badge-assertive nav-icon-badge">{{unreadCount}}</span>',replace:!0,controller:["$scope",function(t){t.unreadCount=e.getUnreadChatsCount(),t.$on("unreadChatsCountUpdated",function(){return t.unreadCount=e.getUnreadChatsCount()})}]}}]),angular.module("ionicApp").directive("facebookDetails",["AppService","$rootScope","$cordovaFacebook",function(e,t,i){return{restrict:"E",scope:{},templateUrl:"facebook/facebook-details.html",controller:["$scope",function(e){if(t.facebookConnected){var o=localStorage.getItem("facebookLikes");o&&(e.likes=JSON.parse(o));var n=localStorage.getItem("facebookFriends");n&&(e.friends=JSON.parse(n)),i.api("/me/friends").then(function(t){e.friends=t.data,localStorage.setItem("facebookFriends",JSON.stringify(t.data)),i.api("/me/likes").then(function(t){e.likes=t.data,localStorage.setItem("facebookLikes",JSON.stringify(t.data))})})}}]}}]);var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t,i,o,n,r,s,a,l){var c=this;_classCallCheck(this,e),this.$log=t,this.$scope=i,this.$stateParams=o,this.$ionicHistory=n,this.$ionicActionSheet=r,this.AppUtil=s,this.AppService=a,this.$translate=l,l(["REQUEST_FAILED","REPORT","INAPPROPRIATE_CONTENT","CANCEL"]).then(function(e){c.translations=e}),i.$on("$ionicView.beforeEnter",function(e,t){return c.ionViewWillEnter()})}return e.$inject=["$log","$scope","$stateParams","$ionicHistory","$ionicActionSheet","AppUtil","AppService","$translate"],_createClass(e,[{key:"ionViewWillEnter",value:function(){var e=this;this.profile=this.$stateParams.profile,this.$scope.profile=this.profile,this.AppService.getProfileOfSelectedUser(this.profile.objectId).then(function(t){e.profilePointer=t})}},{key:"like",value:function(){var e=this.AppService.getProfileSearchResults().pop();this.AppService.processMatch(e,!0),this.$ionicHistory.goBack()}},{key:"reject",value:function(){var e=this.AppService.getProfileSearchResults().pop();this.AppService.processMatch(e,!1),this.$ionicHistory.goBack()}},{key:"profileOptions",value:function(){var e=this;this.$ionicActionSheet.show({destructiveText:this.translations.REPORT,titleText:this.translations.INAPPROPRIATE_CONTENT,cancelText:this.translations.CANCEL,cancel:function(){},destructiveButtonClicked:function(t){return e.report(),!0}})}},{key:"report",value:function(){var e=this,t=this.AppService.getProfileSearchResults().pop();this.AppUtil.blockingCall(this.AppService.reportProfile("inappropriate profile content",this.profilePointer,null),function(){e.AppService.processMatch(t,!1),e.$ionicHistory.goBack()})}}]),e}();t.$inject=["$log","$scope","$stateParams","$ionicHistory","$ionicActionSheet","AppUtil","AppService","$translate"],e.SearchProfileView=t,angular.module("ionicApp").controller("SearchProfileView",t)}(app||(app={})),angular.module("ionicApp").filter("profileAge",function(){return function(e){return e.age?e.age:e.birthdate?new Date(new Date-e.birthdate).getFullYear()-1970:""}}),angular.module("ionicApp").directive("profileDetails",["AppService",function(e){return{restrict:"E",scope:{profile:"="},templateUrl:"profile/profile-details.html",controller:["$scope",function(t){var i=e.getProfile(),o=i.location,n=t.profile;if(n.location._latitude&&n.location._longitude){var r="http://maps.googleapis.com/maps/api/geocode/json?latlng="+n.location._latitude+","+n.location._longitude+"&sensor=false&language=en",s=void 0;fetch(r).then(function(e){return e.json()}).then(function(e){n.address=e.results[0].formatted_address,e.results[6]?s=6:e.results[5]?s=5:e.results[4]&&(s=4),n.country=e.results[s].formatted_address})["catch"](function(e){return console.error(e)})}if(o&&n.location){var a=GeoUtils.getDistanceFromLatLonInKm(n.location.latitude,n.location.longitude,o.latitude,o.longitude);"mi"===i.distanceType&&(a*=.621371);var l=a.toFixed(0);t.distance=("0"===l?1:l)+i.distanceType}t.isCurrentUser=n.id===i.id}]}}]);var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function o(e){_classCallCheck(this,o),this.file=e,this.selected=!1},i=function(){function e(t,i,o,n,r,s,a,l,c,p,u,h){var f=this;_classCallCheck(this,e),this.MAX_PHOTOS=3,this.NO_IMAGE="img/add.png",this.photos=[],this.photosInReview=[],this.$log=t,this.$rootScope=i,this.$scope=o,this.$q=n,this.$state=r,this.$ionicActionSheet=s,this.$cordovaCamera=a,this.AppService=l,this.AppUtil=c,this.$translate=p,this.$ionicHistory=u,this.$ionicPopup=h,this.$scope.options={onlyExternal:!0,speed:700},this.$scope.$on("$ionicView.beforeEnter",function(){return f.refresh()}),this.$scope.$on("$ionicView.enter",function(){return f.expandText()}),this.$scope.$on("$ionicSlides.sliderInitialized",function(e,t){o.slider=t.slider}),this.$scope.$on("$ionicSlides.slideChangeStart",function(e,t){console.log("Slide change is beginning")})}return e.$inject=["$log","$rootScope","$scope","$q","$state","$ionicActionSheet","$cordovaCamera","AppService","AppUtil","$translate","$ionicHistory","$ionicPopup"],_createClass(e,[{key:"refresh",value:function(){this.profile=this.AppService.getProfile(),this.about=this.profile.about,this.personCategory=this.profile.personCategory,this.personType=this.profile.personType,this.personSperm=this.profile.personSperm,this.personEgg=this.profile.personEgg,this.personWomb=this.profile.personWomb,this.personEmbryo=this.profile.personEmbryo,this.personHelpLevel=this.profile.personHelpLevel,this.photos=_.map(this.profile.photos,function(e){return new t(e)}),this.photosInReview=this.profile.photosInReview?_.map(this.profile.photosInReview,function(e){return new t(e)}):[],this.onRedirectToEditProfile(!1)}},{key:"selectedCount",value:function(){return _.filter(this.photos,function(e){return e.selected}).length}},{key:"canAddPhoto",value:function(){return this.photos.length+this.photosInReview.length<this.MAX_PHOTOS}},{key:"canDeletePhotos",value:function(){return _.filter(this.photos,function(e){return e.selected}).length+_.filter(this.photosInReview,function(e){return e.selected}).length>0}},{key:"deletePhotos",value:function(){var e=this,t={},i=_.filter(this.photos,function(e){return!e.selected});t.photos=_.map(i,function(e){return e.file});var o=_.filter(this.photosInReview,function(e){return!e.selected});t.photosInReview=_.map(o,function(e){return e.file}),this.AppUtil.blockingCall(this.AppService.saveProfile(t),function(){return e.refresh()})}},{key:"swapPhotos",value:function(){var e=this,t=_.findIndex(this.photos,function(e){return e.selected}),i=_.findLastIndex(this.photos,function(e){return e.selected}),o={};this.swapArrayElements(this.photos,t,i),o.photos=_.map(this.photos,function(e){return e.file}),this.AppUtil.blockingCall(this.AppService.saveProfile(o),function(){return e.refresh()})}},{key:"toggleSelected",value:function(e){e.selected=!e.selected}},{key:"addPhoto",value:function(){var e=this,t=[{text:this.$translate.instant("TAKE_PHOTO")},{text:this.$translate.instant("GALLERY")}];this.$rootScope.facebookConnected&&t.push({text:"Facebook"}),this.$ionicActionSheet.show({buttons:t,titleText:this.$translate.instant("SELECT_PHOTO_SOURCE"),cancelText:this.$translate.instant("CANCEL"),buttonClicked:function(t){if(2===t)e.$state.go("^.fb-albums");else{if(!ionic.Platform.isWebView())return!0;var i=0===t?Camera.PictureSourceType.CAMERA:Camera.PictureSourceType.PHOTOLIBRARY,o={quality:70,destinationType:Camera.DestinationType.DATA_URL,sourceType:i,allowEdit:!1,encodingType:Camera.EncodingType.PNG,targetWidth:800,targetHeight:800,saveToPhotoAlbum:!1};e.$cordovaCamera.getPicture(o).then(function(t){var i="data:image/jpeg;base64,"+t;e.$rootScope.cropPhoto=i,e.$state.go("^.crop")},function(t){"has no access to assets"===t?(e.AppUtil.toastSimple("Access to photo gallery denied"),e.$log.error("$cordovaCamera.getPicture error "+JSON.stringify(t))):(e.AppUtil.toastSimpleTranslate("PHOTO_ERROR"),e.$log.error("$cordovaCamera.getPicture error "+JSON.stringify(t)))})}return!0}})}},{key:"expandText",value:function(){var e=document.querySelector("#aboutYou");e.style.height=e.scrollHeight+"px"}},{key:"swapArrayElements",value:function(e,t,i){var o=e[t];e[t]=e[i],e[i]=o}},{key:"saveProfile",value:function(){var e=this,t={};t.about=this.about,t.personCategory=this.personCategory?this.personCategory:"0",t.hasSelfId=!0,"3"===this.personCategory?(t.personType="0",t.personSperm=!1,t.personEgg=!1,t.personWomb=!1,t.personEmbryo=!1,t.personHelpLevel="0"):(t.personType=this.personType?this.personType:"0",t.personSperm=!!this.personSperm&&this.personSperm,t.personEgg=!!this.personEgg&&this.personEgg,t.personWomb=!!this.personWomb&&this.personWomb,t.personEmbryo=!!this.personEmbryo&&this.personEmbryo,t.personHelpLevel=this.personHelpLevel?this.personHelpLevel:"0");var i="";t.personSperm&&(i+="S"),t.personEgg&&(i+="E"),t.personWomb&&(i+="W"),t.personEmbryo&&(i+="Y"),"3"===this.personCategory||t.personSperm||t.personEgg||t.personWomb||t.personEmbryo||(i+="X"),t.thingsIHave=i,this.AppUtil.blockingCall(this.AppService.saveProfile(t),function(){e.refresh(),e.$ionicHistory.nextViewOptions({historyRoot:!1,disableBack:!0}),e.profile.about&&e.$state.go("menu.profile")})}},{key:"myGoBack",value:function(){this.$ionicHistory.goBack()}},{key:"onRedirectToEditProfile",value:function(e){if(!this.profile.about||e){this.$ionicPopup.alert({title:"We need more information",cssClass:"center",template:'Your "About Me" section is empty.</br> Everyone is looking for someone with a compatible vision. A deep description adds value to the community, tell us about you.'})}}},{key:"onClickBadgeInfo",value:function(){this.$ionicPopup.alert({title:"Self Identification Badges",templateUrl:"badgeInfo.html",buttons:[{text:"Ok",type:"button-assertive"}]})}}]),e}();e.ProfileEdit=i,i.$inject=["$log","$rootScope","$scope","$q","$state","$ionicActionSheet","$cordovaCamera","AppService","AppUtil","$translate","$ionicHistory","$ionicPopup"],angular.module("controllers").controller("ProfileEdit",i)}(app||(app={})),angular.module("ionicApp").filter("profileImageUrl",function(){return function(e){if(!e)return"";if(e.photos&&e.photos.length){var t=e.photos[0];if(t._url)return t._url;if(angular.isFunction(t.url))return t.url();if(angular.isString(t.url)){var i=t.url;return i}}return"img/generic_avatar.jpg"}});var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t,i,o,n){var r=this;_classCallCheck(this,e),this.$rootScope=t,this.$scope=i,this.$state=o,this.AppService=n,i.$on("$ionicView.beforeEnter",function(){return r.ionViewWillEnter()})}return e.$inject=["$rootScope","$scope","$state","AppService"],_createClass(e,[{key:"ionViewWillEnter",value:function(){this.profile=this.AppService.getProfile(),this.$scope.profile=this.profile}}]),e}();e.ProfileViewCurrentUser=t,t.$inject=["$rootScope","$scope","$state","AppService"],angular.module("ionicApp").controller("ProfileViewCurrentUser",t)}(app||(app={})),angular.module("ionicApp").filter("fileUrl",function(){return function(e){if(!e)return null;if(e._url)return e._url;if(angular.isFunction(e.url))return e.url();if(angular.isString(e.url))return e.url;throw"unknown file "+JSON.stringify(e)}}),angular.module("ionicApp").filter("distance",["AppService",function(e){return function(t){function i(e,t,i,n){var r=6371,s=o(i-e),a=o(n-t),l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(o(e))*Math.cos(o(i))*Math.sin(a/2)*Math.sin(a/2),c=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),p=r*c;return p}function o(e){return e*(Math.PI/180)}if(!t||!angular.isNumber(t.latitude)||!angular.isNumber(t.longitude))return"";var n=e.getProfile(),r=n.location,s=t,a=i(r.latitude,r.longitude,s.latitude,s.longitude);"mi"===n.distanceType&&(a*=.621371);var l=a.toFixed(0);return l="0"===l?"1":l,l+=n.distanceType}}]),angular.module("ionicApp").config(["$provide","serverUrl",function(e,t,i){if(!t)return void console.error("ERROR: serverUrl config value not configured for logging");var o=void 0;e.decorator("$log",["$delegate","$injector",function(e,n){function r(e){try{e[0]&&(d.unshift(e[0]),d.length>h&&d.pop())}catch(t){}}var s,a=e.debug,l=e.info,c=e.log,p=e.warn,u=e.error,h=30,f=1e4,d=[],v="",g=0;return e.debug=function(){var e=[].slice.call(arguments);a.apply(null,e),r(e)},e.info=function(){var e=[].slice.call(arguments);l.apply(null,e),r(e)},e.log=function(){var e=[].slice.call(arguments);c.apply(null,e),r(e)},e.warn=function(){var e=[].slice.call(arguments);p.apply(null,e),r(e)},e.error=function(){var e=[].slice.call(arguments);u.apply(null,e);try{if(!o){var a=n.get("$rootScope");o="&appVersion="+a.appVersion+"&platform="+encodeURIComponent(ionic.Platform.platform())+"&platformVersion="+encodeURIComponent(""+ionic.Platform.version()),s=n.get("AppService")}var l=s.userId,c=e[0]||"";if(c!==v&&Date.now()>g+f){var p=new XMLHttpRequest;p.open("POST",t+"/client-log",!0),p.setRequestHeader("Content-type","application/x-www-form-urlencoded"),p.setRequestHeader("X-Parse-Application-Id",i);var h="userId="+encodeURIComponent(l)+"&message="+encodeURIComponent(c)+"&recent="+encodeURIComponent(JSON.stringify(d))+o;v=c,g=Date.now(),p.send(h)}}catch($){console.log("Error submitting error log to server:"+$)}r(e)},e}])}]);var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t,i,o,n){_classCallCheck(this,e),this.$q=t,this.$log=i,this.$http=o,this.$translate=n}return _createClass(e,[{key:"linkedIn",value:function(e,t,i,o){var n=this,r=this.$q.defer();if(window.cordova){var s=cordova.require("cordova/plugin_list").metadata;if(s.hasOwnProperty("cordova-plugin-inappbrowser")===!0||s.hasOwnProperty("org.apache.cordova.inappbrowser")===!0){var a=window.open("https://www.linkedin.com/uas/oauth2/authorization?client_id="+e+"&redirect_uri=http://localhost/callback&scope="+i.join(" ")+"&response_type=code&state="+o,"_blank","location=no,clearsessioncache=yes,clearcache=yes");a.addEventListener("loadstart",function(i){if(0===i.url.indexOf("http://localhost/callback")){var o=i.url.split("code=")[1];n.$http.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",n.$http({method:"post",url:"https://www.linkedin.com/uas/oauth2/accessToken",data:"client_id="+e+"&client_secret="+t+"&redirect_uri=http://localhost/callback&grant_type=authorization_code&code="+o}).success(function(e){r.resolve(e)}).error(function(e,t){r.reject("Problem authenticating LinkedIn "+JSON.stringify(e)+" "+JSON.stringify(t))})["finally"](function(){setTimeout(function(){a.close()},10)})}}),a.addEventListener("exit",function(e){r.reject("The LinkedIn sign in flow was canceled")})}else r.reject("LinkedIn auth: Could not find InAppBrowser plugin")}else r.reject("Cannot authenticate LinkedIn via a web browser");return r.promise}}],[{key:"socialAuthFactory",value:function(t,i,o,n){return new e(t,i,o,n)}}]),e}();e.SocialAuth=t,t.socialAuthFactory.$inject=["$q","$log","$http","$translate"],angular.module("SocialAuth",["pascalprecht.translate"]).factory("SocialAuth",t.socialAuthFactory)}(app||(app={}));var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t,i,o,n,r){var s=this;_classCallCheck(this,e),this.$q=t,this.$ionicLoading=i,this.ionicToast=o,this.$log=r,this.$translate=n,n(["REQUEST_FAILED"]).then(function(e){return s.translations=e})}return _createClass(e,[{key:"toastSimple",value:function(e){this.ionicToast.show(e,"bottom",!1,3e3)}},{key:"toastSimpleTranslate",value:function(e){var t=this;this.$translate([e]).then(function(i){var o=i[e];o===e&&t.$log.warn("Invalid translation key "+e),t.toastSimple(o)},function(e){return t.$log.warn("toast translation error "+JSON.stringify(e))})}},{key:"blockingCall",value:function(e,t,i,o){var n=this,r=this.$ionicLoading;return r.show({templateUrl:"loading.html",delay:400}),e.then(function(e){r.hide(),t&&t(e)},function(e){r.hide();var t=n.resolveErrorMessage(e);t?n.toastSimple(t):i?n.toastSimpleTranslate(o):o?n.toastSimple(o):n.toastSimple(n.translations.REQUEST_FAILED),n.$log.error("Error in blocking call "+JSON.stringify(e))}),e}},{key:"resolveErrorMessage",value:function(e){if(this.$log.error(JSON.stringify(e)),e.code)switch(e.code){case 100:return"Request failed, try again";case 155:return"Server busy, try again later";case 209:return"Invalid session. Log in again";default:return null}return null}}],[{key:"appUtilFactory",value:function(t,i,o,n,r){return new e(t,i,o,n,r)}}]),e}();e.AppUtil=t,t.appUtilFactory.$inject=["$q","$ionicLoading","ionicToast","$translate","$log"],angular.module("AppUtil",["ionic","pascalprecht.translate","ionic-toast"]).factory("AppUtil",t.appUtilFactory)}(app||(app={}));var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),GeoUtils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getDistanceFromLatLonInKm",value:function(e,t,i,o){if(!(e&&t&&i&&o))return console.log("Not all params supplied for getDistanceFromLatLonInKm"),null;var n=6371,r=this.degreesToRadians(i-e),s=this.degreesToRadians(o-t),a=Math.sin(r/2)*Math.sin(r/2)+Math.cos(this.degreesToRadians(e))*Math.cos(this.degreesToRadians(i))*Math.sin(s/2)*Math.sin(s/2),l=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),c=n*l;return c}},{key:"degreesToRadians",value:function(e){return e*(Math.PI/180)}}]),e}(),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),app;!function(e){var t=function(){function e(t){_classCallCheck(this,e),this.$q=t}return _createClass(e,[{key:"convertImgUrlToBase64",value:function(e,t){var i=this.$q.defer(),o=document.createElement("CANVAS"),n=o.getContext("2d"),r=new Image;return r.crossOrigin="Anonymous",r.onload=function(){var e=void 0;o.height=r.height,o.width=r.width,n.drawImage(r,0,0),e=o.toDataURL(t),o=null,i.resolve(e)},r.onerror=function(){return i.reject("Failed to load image "+e)},r.src=e,i.promise}},{key:"convertImgIdToBase64",value:function(e){if(!e)throw"convertImgIdToBase64 requires imgId";var t=document.getElementById(e);if(!t)throw"Could not find element with id "+e;return this.convertImgToBase64(t)}},{key:"convertImgToBase64",value:function(e){var t=document.createElement("canvas");t.width=e.clientWidth,t.height=e.clientHeight;var i=t.getContext("2d");i.drawImage(e,0,0);var o=t.toDataURL("image/png");return o.replace(/^data:image\/(png|jpg);base64,/,"")}}],[{key:"imagesUtilFactory",value:function(t){return new e(t)}}]),e}();e.ImagesUtil=t,t.imagesUtilFactory.$inject=["$q"],angular.module("ImagesUtil",[]).factory("ImagesUtil",t.imagesUtilFactory)}(app||(app={}));
//# sourceMappingURL=maps/app.ts.js.map
